sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","../model/formatter"],function(e,t,s,i,o,a,+
r,n,l){"use strict";return e.extend("com.lit.zui5.material.deposito.controller.View1",{formatter:l,onInit:function(){var e=this.byId("listMain");this._oTable=e;var t={aFilter:[],aSearch:[]};this._oListFilterState=t;var s=new r({busy:true,delay:0,layout:"+
OneColumn",previousLayout:"",aprovados:0,pendentes:0,reprovados:0,todos:0,ativos:0,inativos:0,actionButtonsInfo:{midColumn:{fullScreen:false}}});this.getView().setModel(s,"view1View");this._mFilters={aprovados:[new o("Status",a.EQ,"A")],reprovados:[new o+
("Status",a.EQ,"R")],pendentes:[new o("Status",a.EQ,"P")],todos:[],ativos:[new o("Ativo",a.EQ,true)],inativos:[new o("Ativo",a.EQ,false)]}},onListUpdateFinished:function(){var e=this.getView().getModel("view1View");this.getView().getModel().read("/zlmot0+
21Set/$count",{success:function(t){e.setProperty("/todos",t)}});this.getView().getModel().read("/zlmot021Set/$count",{success:function(t){e.setProperty("/aprovados",t)},filters:this._mFilters.aprovados});this.getView().getModel().read("/zlmot021Set/$coun+
t",{success:function(t){e.setProperty("/reprovados",t)},filters:this._mFilters.reprovados});this.getView().getModel().read("/zlmot021Set/$count",{success:function(t){e.setProperty("/pendentes",t)},filters:this._mFilters.pendentes});this.getView().getMode+
l().read("/zlmot021Set/$count",{success:function(t){e.setProperty("/ativos",t)},filters:this._mFilters.ativos});this.getView().getModel().read("/zlmot021Set/$count",{success:function(t){e.setProperty("/inativos",t)},filters:this._mFilters.inativos})},onQ+
uickFilter:function(e){var t=e.getParameter("selectedKey");this._oTable.getBinding("items").filter(this._mFilters[t])},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}var t=e.getParameter("query").toUpperCase();if(+
t){this._oListFilterState.aSearch=[new o("Werks",a.Contains,t),new o("Matnr",a.Contains,t),new o("CriadoPor",a.Contains,t)]}else{this._oListFilterState.aSearch=[]}this._applyFilterSearch()},_applyFilterSearch:function(){var e=this._oListFilterState.aSear+
ch.concat(this._oListFilterState.aFilter),t=this.getView().getModel("view1View");this._oTable.getBinding("items").filter(e,"Application");if(e.length!==0||this._oListFilterState.aSearch.length>0){t.setProperty("/noDataText",this.getOwnerComponent().getMo+
del("i18n").getResourceBundle().getText("detailLineItemTableNoDataText"))}},onRefresh:function(){this._oTable.getBinding("items").refresh()},onBtnDeletePress:function(){var e=this._oTable.getSelectedItems();var t=this.getView().getModel();var s;if(e.leng+
th==0){sap.m.MessageToast.show("Favor selecionar algum registro");return}for(var i=0;i<e.length;i++){s=e[i].getBindingContext();if(e.length>1){sap.m.MessageToast.show("Favor selecionar só um registro")}else{sap.m.MessageBox.warning("Deseja exclui o regis+
tro selecionado?",{title:"Alerta",actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e==sap.m.MessageBox.Action.OK){t.remove(s.getPath(),{success:jQuery.proxy(function(e,t){var s=JSON.parse(t.headers["sap-message"]+
);sap.m.MessageToast.show(s.message,{width:"15em"})},this),error:jQuery.proxy(function(e){var t=JSON.parse(e.responseText);sap.m.MessageBox.show(t.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,title:"Erro ao Eliminar Material",actions:[sap.m.Mess+
ageBox.Action.OK],onClose:null,emphasizedAction:sap.m.MessageBox.Action.OK})},this)})}}})}}},onBtnApproveOrRepprovePress:function(e){var t=this._oTable.getSelectedItems();var s=this.getView().getModel();var i;const o=e=="A"?"aprovar":"reprovar";if(t.leng+
th==0){sap.m.MessageToast.show("Favor selecionar algum registro");return}for(var a=0;a<t.length;a++){i=t[a].getBindingContext();i.getProperty().Status=e;if(t.length>1){sap.m.MessageToast.show("Favor selecionar só um registro")}else{sap.m.MessageBox.warni+
ng("Deseja "+o+" o registro selecionado?",{title:"Alerta",actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(e){if(e==sap.m.MessageBox.Action.OK){s.update(i.getPath(),i.getProperty(),{success:jQuery.proxy(function(e,t){}+
,this),error:jQuery.proxy(function(e){var t=JSON.parse(e.responseText);sap.m.MessageBox.show(t.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,title:"Erro ao editar o Material",actions:[sap.m.MessageBox.Action.OK],onClose:null,emphasizedAction:sap.+
m.MessageBox.Action.OK})},this)})}}})}}},onOpenViewSettings:function(e){var t="filter";if(e.getSource()instanceof sap.m.Button){var s=e.getSource().getId();if(s.match("sort")){t="sort"}else if(s.match("group")){t="group"}}if(!this.byId("viewSettingsDialo+
g")){n.load({id:this.getView().getId(),name:"com.lit.zui5.material.deposito.view.ViewSettingsDialog",controller:this}).then(function(e){this.getView().addDependent(e);e.open(t)}.bind(this))}else{this.byId("viewSettingsDialog").open(t)}},onConfirmViewSett+
ingsDialog:function(e){var t=e.getParameters(),s,o,a=[];s=t.sortItem.getKey();o=t.sortDescending;a.push(new i(s,o));this._oTable.getBinding("items").sort(a)},onBtnCreatePress:function(){var e=this.getView().getModel("editMaterialModel");e.setProperty("/i+
sNotNew",false);var t=this.getView().getModel();t.setDeferredGroups(["creategroupId"]);t.setChangeGroups({zlmot021Set:{groupId:"creategroupId",changeSetId:"ID"}});var s=t.createEntry("/zlmot021Set",{groupId:"creategroupId",properties:{}});this.getView().+
bindElement(s.getPath());this._onViewNewOpen()},_onViewNewOpen:function(){if(!this.oDialogNewMaterial){this.oDialogNewMaterial=n.load({id:this.getView().getId(),name:"com.lit.zui5.material.deposito.view.ViewNew",controller:this}).then(function(e){this.ge+
tView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());this.oDialogNewMaterial=e;this.oDialogNewMaterial.open();this.buttonPressed=this.oDialogNewMaterial}.bind(this))}else{this.oDialogNewMaterial.open();this.buttonPre+
ssed=this.oDialogNewMaterial}},onBtnEditPress:function(e){var t=this.getView().getModel("editMaterialModel");t.setProperty("/isNotNew",true);var s=e.getSource().getBindingContext();var i=new r(s.getObject());this._onViewEditOpen(i)},_onViewEditOpen:funct+
ion(e){if(!this.oDialogEditMaterial){this.oDialogEditMaterial=n.load({id:this.getView().getId(),name:"com.lit.zui5.material.deposito.view.ViewEdit",controller:this}).then(function(t){this.idDialog=this.byId("dialogEditMaterial");this.getView().addDepende+
nt(t);t.addStyleClass(this.getOwnerComponent().getContentDensityClass());t.setModel(e,"oModelItens");this.oDialogEditMaterial=t;this.oDialogEditMaterial.open();this.buttonPressed=this.oDialogEditMaterial}.bind(this))}else{var t=this.idDialog;this.getView+
().addDependent(t);t.addStyleClass(this.getOwnerComponent().getContentDensityClass());t.setModel(e,"oModelItens");this.oDialogEditMaterial=t;this.oDialogEditMaterial.open();this.buttonPressed=this.oDialogEditMaterial}},onSaveMaterialButtonPress:function(+
){var e=this.getView().getModel();if(this.buttonPressed==this.oDialogEditMaterial){var t=this.oDialogEditMaterial.getModel("oModelItens").getData();var s=new r({Lgnum:t.Lgnum,Werks:t.Werks,Matnr:t.Matnr,Ativo:t.Ativo,Status:t.Status});var i="/zlmot021Set+
(Lgnum='"+s.getData().Lgnum+"',Werks='"+s.getData().Werks+"',Matnr='"+s.getData().Matnr+"')";e.update(i,s.getData(),{success:jQuery.proxy(function(e,t){sap.m.MessageToast.show("Material editado com sucesso!",{width:"15em"});this.oDialogEditMaterial.close+
()},this),error:jQuery.proxy(function(e){var t=JSON.parse(e.responseText);sap.m.MessageBox.show(t.error.message.value,{icon:sap.m.MessageBox.Icon.ERROR,title:"Erro ao editar o Material",actions:[sap.m.MessageBox.Action.OK],onClose:null,emphasizedAction:s+
ap.m.MessageBox.Action.OK})},this)})}else if(this.buttonPressed==this.oDialogNewMaterial){e.submitChanges({success:this._handleSuccessSave.bind(this),error:this._handleSaveError.bind(this)})}},_handleSuccessSave:function(e,i){var o=this.getView().getMode+
l();if(e.__batchResponses[0].response){var a=parseInt(e.__batchResponses[0].response.statusCode);if(a>=400){var r=JSON.parse(e.__batchResponses[0].response.body);t.alert("Erro ao Salvar. ERRO: "+r.error.message.value);o.resetChanges();o.refresh()}else{s.+
show("Salvo com sucesso!");if(this.buttonPressed==this.oDialogNewMaterial){this.oDialogNewMaterial.close()}else if(this.buttonPressed==this.oDialogEditMaterial){this.oDialogEditMaterial.close()}}}else if(e.__batchResponses[0].__changeResponses){var a=par+
seInt(e.__batchResponses[0].__changeResponses[0].statusCode);if(a>=400){t.alert("Erro ao Salvar");o.resetChanges();o.refresh()}else{s.show("Salvo com sucesso!");if(this.buttonPressed==this.oDialogNewMaterial){this.oDialogNewMaterial.close()}else if(this.+
buttonPressed==this.oDialogEditMaterial){this.oDialogEditMaterial.close()}}}},_handleSaveError:function(e){var s=this.getView().getModel();if(e){if(e.responseText){var i=JSON.parse(e.responseText);t.alert(i.error.message.value);s.resetChanges();s.refresh+
()}}},onCancelMaterial:function(){var e=this.getView().getModel();e.resetChanges();if(this.buttonPressed==this.oDialogNewMaterial){this.oDialogNewMaterial.close()}else if(this.buttonPressed==this.oDialogEditMaterial){this.oDialogEditMaterial.close()}}})}+
);                                                                                                                                                                                                                                                             
//# sourceMappingURL=View1.controller.js.map                                                                                                                                                                                                                   