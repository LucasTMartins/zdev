sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","../model/formatter","sap/m/MessageBox"],function(e,t,a,i){"use strict";return e.extend("br.com.lit.zui5.ne.logistics.offline.controller.CockpitTransfStock",{formatter:a,onInit:fun+
ction(){const e=new t;this.getView().setModel(e,"Cockpit");var a=new t({page:0,previousPageAvailable:false,nextPageAvailable:false});this.getView().setModel(a,"CockpitPage");const i=new t({sapOnline:true});this.getView().setModel(i);const s=this.getOwner+
Component().getRouter();s.getRoute("RouteCockpitTransfStock").attachPatternMatched(this.onBeforeShow,this);s.getRoute("RouteMenu").attachPatternMatched(this.onAfterHide,this);let l=new t([{status:"PROCESSED"},{status:"PENDING"},{status:"ERROR"},{status:"+
CANCELED"}]);this.getView().setModel(l,"ValueHelpStatus")},onBeforeShow:function(){self=this;let e=this.getView().getModel("CockpitPage");e.setProperty("/page",0);this.onBtnClearPress();this.getCockpitData();this.checkStatusOnline();this.intervalHandler=+
setInterval(function(){self.getCockpitData();self.checkStatusOnline()},6e4)},onAfterHide:function(){clearInterval(this.intervalHandler)},getCockpitData:function(){let e=this.getView().getModel("Cockpit");var t=this.getView().getModel("CockpitPage");let a+
=t.getProperty("/page");let s=this.getView().byId("searchFieldStatus");let l=this.getView().byId("searchFieldWerks");let o=this.getView().byId("searchFieldLgnum");let n=this.getView().byId("searchFieldCrdate");let r=this.getView().byId("searchFieldCrtime+
Ini");let g=this.getView().byId("searchFieldCrtimeFim");let u=s.getValue()?s.getValue().toUpperCase():"PENDING";let c=`http://localhost:8080/v1/intfsap?page=${a}sort=crdate&status=${u}`;let p=this.getView().getModel("ValueHelpStatus").getData().find(e=>e+
.status===u);if(!p){i.error("Status inválido!");return}if(l.getValue()!==""){c+="&werks="+l.getValue()}if(o.getValue()!==""){c+="&lgnum="+o.getValue()}$.ajax({method:"GET",url:c,contentType:"application/json",success:function(t){t.forEach(e=>{if(e.charg=+
="0"){e.charg=""}e.matnr=e.matnr.replace(/^0+/,"");const[t,a]=e.crdate.split("T");const[i,s,l]=t.split("-");e.crdate=`${l}/${s}/${i}`;e.crtime=a?a.split(".")[0]:"";e.crdateaux=new Date(`${i}-${s}-${l}T${a}`)});let a=t;if(n.getValue()!==""){let e=n.getDat+
eValue();let i=n.getSecondDateValue();a=t.filter(t=>e<=t.crdateaux&&t.crdateaux<=i)}if(r.getValue()!==""){a=g.getValue()!==""?a.filter(e=>r.getValue()<=e.crtime&&e.crtime<=g.getValue()):a.filter(e=>e.crtime===r.getValue())}e.setData(a)},error:function(e)+
{console.log(e)}});this.verifyPreviousPage();this.verifyNextPage()},verifyPreviousPage:function(){let e=this.getView().getModel("CockpitPage");let t=e.getProperty("/page");e.setProperty("/previousPageAvailable",t>0?true:false)},verifyNextPage:function(){+
var e=this.getView().getModel("CockpitPage");let t=e.getProperty("/page");let a=this.getView().byId("searchFieldStatus");let i=this.getView().byId("searchFieldWerks");let s=this.getView().byId("searchFieldLgnum");let l=this.getView().byId("searchFieldCrd+
ate");let o=this.getView().byId("searchFieldCrtimeIni");let n=this.getView().byId("searchFieldCrtimeFim");let r=a.getValue()?a.getValue().toUpperCase():"PENDING";let g=`http://localhost:8080/v1/intfsap?page=${t}sort=crdate&status=${r}`;if(i.getValue()!==+
""){g+="&werks="+i.getValue()}if(s.getValue()!==""){g+="&lgnum="+s.getValue()}$.ajax({method:"GET",url:g,contentType:"application/json",success:function(){e.setProperty("/nextPageAvailable",data.length>0?true:false)},error:function(){e.setproperty("/next+
pageavailable",false)}})},onPreviousPageBtnPress:function(){let e=this.getView().getModel("CockpitPage");let t=e.getProperty("/page")-1;e.setProperty("/page",t);this.getCockpitData()},onNextPageBtnPress:function(){let e=this.getView().getModel("CockpitPa+
ge");let t=e.getProperty("/page")+1;e.setProperty("/page",t);this.getCockpitData()},onBtnClearPress:function(){this.setFiltersDefaultValues();this.getView().byId("searchFieldCrdate").setValue();this.getView().byId("searchFieldCrtimeIni").setValue();this.+
getView().byId("searchFieldCrtimeFim").setValue();this.getView().byId("searchFieldStatus").setValue();this.getCockpitData()},setFiltersDefaultValues:function(){this.getView().byId("searchFieldWerks").setValue("VX01");this.getView().byId("searchFieldLgnum+
").setValue("VX1")},onValueHelpWerks:function(){let e=new t;this.getView().setModel(e,"ValueHelpWerks");this.byId("valueHelpDialogWerks").open();let a=this.getView().getModel("ValueHelpWerks");let i="http://localhost:8080/v1/lgnum";$.ajax({method:"GET",u+
rl:i,contentType:"application/json",success:function(e){a.setData(e)},error:function(e){console.log(e)}})},onSearchDialogWerks:function(e){let t=e.getParameter("query");let a=this.byId("tableDialogWerks");a.getBinding("items").filter(null);if(t){let e=ne+
w sap.ui.model.Filter("werks",sap.ui.model.FilterOperator.Contains,t);a.getBinding("items").filter(e)}},onSelectionChangeDialogWerks:function(e){this.oWerks=e.getParameter("listItem").getBindingContext("ValueHelpWerks").getProperty("werks")},onSelectionC+
onfirmDialogWerks:function(){this.byId("searchFieldWerks").setValue(this.oWerks);this.byId("valueHelpDialogWerks").close()},onValueHelpLgnum:function(){let e=new t;this.getView().setModel(e,"ValueHelpLgnum");this.byId("valueHelpDialogLgnum").open();let a+
=this.getView().getModel("ValueHelpLgnum");let i="http://localhost:8080/v1/lgnum";$.ajax({method:"GET",url:i,contentType:"application/json",success:function(e){a.setData(e)},error:function(e){console.log(e)}})},onCloseDialogLgnum:function(){this.byId("va+
lueHelpDialogLgnum").close()},onSearchDialogLgnum:function(e){let t=e.getParameter("query");let a=this.byId("tableDialogLgnum");a.getBinding("items").filter(null);if(t){let e=new sap.ui.model.Filter("lgnum",sap.ui.model.FilterOperator.Contains,t);a.getBi+
nding("items").filter(e)}},onSelectionChangeDialogLgnum:function(e){this.oLgnum=e.getParameter("listItem").getBindingContext("ValueHelpLgnum").getProperty("lgnum")},onSelectionConfirmDialogLgnum:function(){this.byId("searchFieldLgnum").setValue(this.oLgn+
um);this.byId("valueHelpDialogLgnum").close()},onValueHelpStatus:function(){this.byId("valueHelpDialogStatus").open()},onCloseDialogStatus:function(){this.byId("valueHelpDialogStatus").close()},onSelectionChangeDialogStatus:function(e){this.oStatus=e.get+
Parameter("listItem").getBindingContext("ValueHelpStatus").getProperty("status")},onSelectionConfirmDialogStatus:function(){this.byId("searchFieldStatus").setValue(this.oStatus);this.byId("valueHelpDialogStatus").close()},checkStatusOnline:function(){con+
st e=this.getView().getModel();const t="/proxy/sap/bc/gui/sap/its/fmcall_json/ZWMF_VERIFICA_CONEXAO";const a=this.getOwnerComponent().USERNAME;const i=this.getOwnerComponent().PASSWORD;const s=this.byId("sendCockpitBtn");const l=btoa(`${a}:${i}`);$.ajax(+
{method:"GET",url:t,contentType:"application/json",headers:{Authorization:`Basic ${l}`},success:function(){e.setProperty("/sapOnline",true);s.setEnabled(true)},error:function(t){console.log(t);e.setProperty("/sapOnline",false);s.setEnabled(true)}}).alway+
s(()=>{this.byId("genericTagCockpitStatusOnline").setVisible(true)})},onBtnSendPress:function(){const e=this.byId("tableCockpit").getSelectedItems();const t="/proxy/sap/bc/gui/sap/its/fmcall_json/ZWMF_TRANSF_POSICAO_API";const a=this.getOwnerComponent().+
USERNAME;const i=this.getOwnerComponent().PASSWORD;e.forEach(e=>{const s=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="id")?.getProperty("text");const l=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="lgnum")?.getProperty("text");let +
o=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="matnr")?.getProperty("text");o=o.padStart(18,"0");const n=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="werks")?.getProperty("text");let r=e.getCells().find(e=>e.getCustomData()[0]?.ge+
tValue()==="charg")?.getProperty("text");if(r==""){r="0"}const g=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="letyp")?.getProperty("text");const u=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="vermeMeins")?.getProperty("number");co+
nst c=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="vermeMeins")?.getProperty("unit");const p=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="vltyp")?.getProperty("text");const h=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==+
="vlpla")?.getProperty("text");const d=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="nltyp")?.getProperty("text");const f=e.getCells().find(e=>e.getCustomData()[0]?.getValue()==="nlpla")?.getProperty("text");let m;let V;let y;$.ajax({method:"G+
ET",url:`http://localhost:8080/v1/lqua?werks=${n}&lgnum=${l}&lgtyp=${p}&lgpla=${h}&matnr=${o}&charg=${r}`,contentType:"application/json",success:function(e){m=e[0].lgort;$.ajax({method:"POST",url:t,contentType:"application/json",headers:{Authorization:"B+
asic "+btoa(a+":"+i)},data:JSON.stringify({I_LGNUM:l,I_MATNR:o,I_WERKS:n,I_LGORT:m,I_CHARG:r,I_LETYP:g,I_ANFME:u,I_ALTME:c,I_VLTYP:p,I_VLPLA:h,I_NLTYP:d,I_NLPLA:f}),success:function(e){const t="Tranferência realizada com sucesso";y=e.E_STATUS==="SUCCESS"+
?t:e.E_MSG;y=t;V=e.E_STATUS},error:function(e){console.log(e)}}).always(()=>{let e;const t=()=>$.ajax({method:"GET",url:"http://localhost:8080/v1/intfsap/"+s,contentType:"application/json",headers:{Authorization:"Basic "+btoa(a+":"+i)}});const l=()=>$.aj+
ax({method:"PUT",url:"http://localhost:8080/v1/intfsap/"+s,contentType:"application/json",data:JSON.stringify(e)}).always(()=>{this.getCockpitData()});t().then(t=>{t.msg=y;t.status=V;e=t;return l()}).always(()=>this.getCockpitData())})}.bind(this),error:+
function(e){}})})}})});                                                                                                                                                                                                                                        
//# sourceMappingURL=CockpitTransfStock.controller.js.map                                                                                                                                                                                                      