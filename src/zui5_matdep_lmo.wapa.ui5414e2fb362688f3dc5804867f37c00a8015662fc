sap.ui.define([                                                                                                                                                                                                                                                
    'sap/ui/core/mvc/Controller',                                                                                                                                                                                                                              
    "sap/m/MessageBox",                                                                                                                                                                                                                                        
    "sap/m/MessageToast",                                                                                                                                                                                                                                      
    'sap/ui/model/Sorter',                                                                                                                                                                                                                                     
    'sap/ui/model/Filter',                                                                                                                                                                                                                                     
    'sap/ui/model/FilterOperator',                                                                                                                                                                                                                             
    'sap/ui/model/json/JSONModel',                                                                                                                                                                                                                             
    'sap/ui/core/Fragment',                                                                                                                                                                                                                                    
    '../model/formatter',                                                                                                                                                                                                                                      
],                                                                                                                                                                                                                                                             
    function (Controller, MessageBox, MessageToast, Sorter, Filter, FilterOperator, JSONModel, Fragment, formatter) {                                                                                                                                          
        "use strict";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        return Controller.extend("com.lit.zui5.material.deposito.controller.View1", {                                                                                                                                                                          
            formatter: formatter,                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            onInit: function () {                                                                                                                                                                                                                              
                var oTable = this.byId("listMain");                                                                                                                                                                                                            
                this._oTable = oTable;                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                var oListFilterState = {                                                                                                                                                                                                                       
                    aFilter: [],                                                                                                                                                                                                                               
                    aSearch: [],                                                                                                                                                                                                                               
                }; this._oListFilterState = oListFilterState;                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                var oViewModel = new JSONModel({                                                                                                                                                                                                               
                    busy: true,                                                                                                                                                                                                                                
                    delay: 0,                                                                                                                                                                                                                                  
                    layout: "OneColumn",                                                                                                                                                                                                                       
                    previousLayout: "",                                                                                                                                                                                                                        
                    aprovados: 0,                                                                                                                                                                                                                              
                    pendentes: 0,                                                                                                                                                                                                                              
                    reprovados: 0,                                                                                                                                                                                                                             
                    todos: 0,                                                                                                                                                                                                                                  
                    ativos: 0,                                                                                                                                                                                                                                 
                    inativos: 0,                                                                                                                                                                                                                               
                    actionButtonsInfo: {                                                                                                                                                                                                                       
                        midColumn: {                                                                                                                                                                                                                           
                            fullScreen: false                                                                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                this.getView().setModel(oViewModel, "view1View");                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                this._mFilters = {                                                                                                                                                                                                                             
                    aprovados: [new Filter("Status", FilterOperator.EQ, "A")],                                                                                                                                                                                 
                    reprovados: [new Filter("Status", FilterOperator.EQ, "R")],                                                                                                                                                                                
                    pendentes: [new Filter("Status", FilterOperator.EQ, "P")],                                                                                                                                                                                 
                    todos: [],                                                                                                                                                                                                                                 
                    ativos: [new Filter("Ativo", FilterOperator.EQ, true)],                                                                                                                                                                                    
                    inativos: [new Filter("Ativo", FilterOperator.EQ, false)],                                                                                                                                                                                 
                };                                                                                                                                                                                                                                             
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            //------------------------------ Atualizando lista                                                                                                                                                                                                 
            onListUpdateFinished: function () {                                                                                                                                                                                                                
                var oModel = this.getView().getModel("view1View");                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                // Contador Total                                                                                                                                                                                                                              
                this.getView().getModel().read("/zlmot021Set/$count", {                                                                                                                                                                                        
                    success: function (oData) {                                                                                                                                                                                                                
                        oModel.setProperty("/todos", oData);                                                                                                                                                                                                   
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                // Contador dos Aprovados                                                                                                                                                                                                                      
                this.getView().getModel().read("/zlmot021Set/$count", {                                                                                                                                                                                        
                    success: function (oData) {                                                                                                                                                                                                                
                        oModel.setProperty("/aprovados", oData);                                                                                                                                                                                               
                    },                                                                                                                                                                                                                                         
                    filters: this._mFilters.aprovados,                                                                                                                                                                                                         
                });                                                                                                                                                                                                                                            
                // Contador dos Reprovados                                                                                                                                                                                                                     
                this.getView().getModel().read("/zlmot021Set/$count", {                                                                                                                                                                                        
                    success: function (oData) {                                                                                                                                                                                                                
                        oModel.setProperty("/reprovados", oData);                                                                                                                                                                                              
                    },                                                                                                                                                                                                                                         
                    filters: this._mFilters.reprovados,                                                                                                                                                                                                        
                });                                                                                                                                                                                                                                            
                // Contador dos Pendentes                                                                                                                                                                                                                      
                this.getView().getModel().read("/zlmot021Set/$count", {                                                                                                                                                                                        
                    success: function (oData) {                                                                                                                                                                                                                
                        oModel.setProperty("/pendentes", oData);                                                                                                                                                                                               
                    },                                                                                                                                                                                                                                         
                    filters: this._mFilters.pendentes,                                                                                                                                                                                                         
                });                                                                                                                                                                                                                                            
                // Contador dos Ativos                                                                                                                                                                                                                         
                this.getView().getModel().read("/zlmot021Set/$count", {                                                                                                                                                                                        
                    success: function (oData) {                                                                                                                                                                                                                
                        oModel.setProperty("/ativos", oData);                                                                                                                                                                                                  
                    },                                                                                                                                                                                                                                         
                    filters: this._mFilters.ativos,                                                                                                                                                                                                            
                });                                                                                                                                                                                                                                            
                // Contador dos Inativos                                                                                                                                                                                                                       
                this.getView().getModel().read("/zlmot021Set/$count", {                                                                                                                                                                                        
                    success: function (oData) {                                                                                                                                                                                                                
                        oModel.setProperty("/inativos", oData);                                                                                                                                                                                                
                    },                                                                                                                                                                                                                                         
                    filters: this._mFilters.inativos,                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
            },                                                                                                                                                                                                                                                 
            //------------------------------ Atualizando lista                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            //------------------------------ Filtros e pesquisa                                                                                                                                                                                                
            // Filtro a cada vez que o tabstrip troca de tab                                                                                                                                                                                                   
            onQuickFilter: function (oEvent) {                                                                                                                                                                                                                 
                var sKey = oEvent.getParameter("selectedKey");                                                                                                                                                                                                 
                this._oTable.getBinding("items").filter(this._mFilters[sKey]);                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            // Pesquisa de centro, material e usuário                                                                                                                                                                                                          
            onSearch: function (oEvent) {                                                                                                                                                                                                                      
                if (oEvent.getParameters().refreshButtonPressed) {                                                                                                                                                                                             
                    this.onRefresh();                                                                                                                                                                                                                          
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var sQuery = oEvent.getParameter("query").toUpperCase();                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                if (sQuery) {                                                                                                                                                                                                                                  
                    this._oListFilterState.aSearch = [                                                                                                                                                                                                         
                        new Filter("Werks", FilterOperator.Contains, sQuery),                                                                                                                                                                                  
                        new Filter("Matnr", FilterOperator.Contains, sQuery),                                                                                                                                                                                  
                        new Filter("CriadoPor", FilterOperator.Contains, sQuery)                                                                                                                                                                               
                    ];                                                                                                                                                                                                                                         
                } else {                                                                                                                                                                                                                                       
                    this._oListFilterState.aSearch = [];                                                                                                                                                                                                       
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                this._applyFilterSearch();                                                                                                                                                                                                                     
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            // Aplicando filtro de pesquisa                                                                                                                                                                                                                    
            _applyFilterSearch: function () {                                                                                                                                                                                                                  
                var aFilters = this._oListFilterState.aSearch.concat(                                                                                                                                                                                          
                    this._oListFilterState.aFilter                                                                                                                                                                                                             
                ), oViewModel = this.getView().getModel("view1View");                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                this._oTable.getBinding("items").filter(aFilters, "Application");                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (aFilters.length !== 0 || this._oListFilterState.aSearch.length > 0) {                                                                                                                                                                      
                    oViewModel.setProperty(                                                                                                                                                                                                                    
                        "/noDataText",                                                                                                                                                                                                                         
                        this.getOwnerComponent().getModel("i18n").getResourceBundle().getText(                                                                                                                                                                 
                            "detailLineItemTableNoDataText"                                                                                                                                                                                                    
                        )                                                                                                                                                                                                                                      
                    );                                                                                                                                                                                                                                         
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            // Atualiza a tabela                                                                                                                                                                                                                               
            onRefresh: function () {                                                                                                                                                                                                                           
                this._oTable.getBinding("items").refresh();                                                                                                                                                                                                    
            },                                                                                                                                                                                                                                                 
            //------------------------------&nbsp;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            //------------------------------ Deletar linha selecionada                                                                                                                                                                                         
            onBtnDeletePress: function () {                                                                                                                                                                                                                    
                var aSelectedItems = this._oTable.getSelectedItems();                                                                                                                                                                                          
                var oDataModel = this.getView().getModel();                                                                                                                                                                                                    
                var oBindingContext;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                if (aSelectedItems.length == 0) {                                                                                                                                                                                                              
                    sap.m.MessageToast.show("Favor selecionar algum registro");                                                                                                                                                                                
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                for (var i = 0; i < aSelectedItems.length; i++) {                                                                                                                                                                                              
                    oBindingContext = aSelectedItems[i].getBindingContext();                                                                                                                                                                                   
                    if (aSelectedItems.length > 1) {                                                                                                                                                                                                           
                        sap.m.MessageToast.show("Favor selecionar só um registro");                                                                                                                                                                            
                    } else {                                                                                                                                                                                                                                   
                        sap.m.MessageBox.warning("Deseja exclui o registro selecionado?", {                                                                                                                                                                    
                            title: "Alerta",                                                                                                                                                                                                                   
                            actions: [sap.m.MessageBox.Action.OK, sap.m.MessageBox.Action.CANCEL],                                                                                                                                                             
                            onClose: function (sAction) {                                                                                                                                                                                                      
                                if (sAction == sap.m.MessageBox.Action.OK) {                                                                                                                                                                                   
                                    oDataModel.remove(oBindingContext.getPath(), {                                                                                                                                                                             
                                        success: jQuery.proxy(function (odata, response) {                                                                                                                                                                     
                                            //Response Header                                                                                                                                                                                                  
                                            var hdrMessageObject = JSON.parse(response.headers["sap-message"]);                                                                                                                                                
                                            sap.m.MessageToast.show(hdrMessageObject.message, {                                                                                                                                                                
                                                width: "15em",                                                                                                                                                                                                 
                                            });                                                                                                                                                                                                                
                                        }, this),                                                                                                                                                                                                              
                                        error: jQuery.proxy(function (oError) {                                                                                                                                                                                
                                            var hdrMessageObject = JSON.parse(oError.responseText);                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                            sap.m.MessageBox.show(hdrMessageObject.error.message.value, {                                                                                                                                                      
                                                icon: sap.m.MessageBox.Icon.ERROR,                                                                                                                                                                             
                                                title: "Erro ao Eliminar Material",                                                                                                                                                                            
                                                actions: [sap.m.MessageBox.Action.OK],                                                                                                                                                                         
                                                onClose: null,                                                                                                                                                                                                 
                                                emphasizedAction: sap.m.MessageBox.Action.OK,                                                                                                                                                                  
                                            });                                                                                                                                                                                                                
                                        }, this),                                                                                                                                                                                                              
                                    });                                                                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            },                                                                                                                                                                                                                                 
                        });                                                                                                                                                                                                                                    
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
            //------------------------------&nbsp;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            //------------------------------ Aprovar ou reprovar linhas selecionadas                                                                                                                                                                           
            onBtnApproveOrRepprovePress: function (_status) {                                                                                                                                                                                                  
                var aSelectedItems = this._oTable.getSelectedItems();                                                                                                                                                                                          
                var oDataModel = this.getView().getModel();                                                                                                                                                                                                    
                var oBindingContext;                                                                                                                                                                                                                           
                const textApproveOrRepprove = _status == 'A' ? 'aprovar' : 'reprovar';                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                if (aSelectedItems.length == 0) {                                                                                                                                                                                                              
                    sap.m.MessageToast.show("Favor selecionar algum registro");                                                                                                                                                                                
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                for (var i = 0; i < aSelectedItems.length; i++) {                                                                                                                                                                                              
                    oBindingContext = aSelectedItems[i].getBindingContext();                                                                                                                                                                                   
                    oBindingContext.getProperty().Status = _status;                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    if (aSelectedItems.length > 1) {                                                                                                                                                                                                           
                        sap.m.MessageToast.show("Favor selecionar só um registro");                                                                                                                                                                            
                    } else {                                                                                                                                                                                                                                   
                        sap.m.MessageBox.warning("Deseja " + textApproveOrRepprove + " o registro selecionado?", {                                                                                                                                             
                            title: "Alerta",                                                                                                                                                                                                                   
                            actions: [sap.m.MessageBox.Action.OK, sap.m.MessageBox.Action.CANCEL],                                                                                                                                                             
                            onClose: function (sAction) {                                                                                                                                                                                                      
                                if (sAction == sap.m.MessageBox.Action.OK) {                                                                                                                                                                                   
                                    oDataModel.update(oBindingContext.getPath(), oBindingContext.getProperty(), {                                                                                                                                              
                                        success: jQuery.proxy(function (odata, response) {                                                                                                                                                                     
                                            //Response Header                                                                                                                                                                                                  
                                            // var hdrMessageObject = JSON.parse(response.headers["sap-message"]);                                                                                                                                             
                                            // sap.m.MessageToast.show(hdrMessageObject.message, {                                                                                                                                                             
                                            //     width: "15em",                                                                                                                                                                                              
                                            // });                                                                                                                                                                                                             
                                        }, this),                                                                                                                                                                                                              
                                        error: jQuery.proxy(function (oError) {                                                                                                                                                                                
                                            var hdrMessageObject = JSON.parse(oError.responseText);                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                            sap.m.MessageBox.show(hdrMessageObject.error.message.value, {                                                                                                                                                      
                                                icon: sap.m.MessageBox.Icon.ERROR,                                                                                                                                                                             
                                                title: "Erro ao editar o Material",                                                                                                                                                                            
                                                actions: [sap.m.MessageBox.Action.OK],                                                                                                                                                                         
                                                onClose: null,                                                                                                                                                                                                 
                                                emphasizedAction: sap.m.MessageBox.Action.OK,                                                                                                                                                                  
                                            });                                                                                                                                                                                                                
                                        }, this),                                                                                                                                                                                                              
                                    });                                                                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            },                                                                                                                                                                                                                                 
                        });                                                                                                                                                                                                                                    
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
            //------------------------------&nbsp;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            //------------------------------ Controle de ordenação                                                                                                                                                                                             
            onOpenViewSettings: function (oEvent) {                                                                                                                                                                                                            
                var sDialogTab = "filter";                                                                                                                                                                                                                     
                if (oEvent.getSource() instanceof sap.m.Button) {                                                                                                                                                                                              
                    var sButtonId = oEvent.getSource().getId();                                                                                                                                                                                                
                    if (sButtonId.match("sort")) {                                                                                                                                                                                                             
                        sDialogTab = "sort";                                                                                                                                                                                                                   
                    } else if (sButtonId.match("group")) {                                                                                                                                                                                                     
                        sDialogTab = "group";                                                                                                                                                                                                                  
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                // load asynchronous XML fragment                                                                                                                                                                                                              
                if (!this.byId("viewSettingsDialog")) {                                                                                                                                                                                                        
                    Fragment.load({                                                                                                                                                                                                                            
                        id: this.getView().getId(),                                                                                                                                                                                                            
                        name: "com.lit.zui5.material.deposito.view.ViewSettingsDialog",                                                                                                                                                                        
                        controller: this,                                                                                                                                                                                                                      
                    }).then(                                                                                                                                                                                                                                   
                        function (oDialog) {                                                                                                                                                                                                                   
                            this.getView().addDependent(oDialog);                                                                                                                                                                                              
                            // oDialog.addStyleClass(                                                                                                                                                                                                          
                            //     this.getOwnerComponent().getContentDensityClass()                                                                                                                                                                           
                            // );                                                                                                                                                                                                                              
                            oDialog.open(sDialogTab);                                                                                                                                                                                                          
                        }.bind(this)                                                                                                                                                                                                                           
                    );                                                                                                                                                                                                                                         
                } else {                                                                                                                                                                                                                                       
                    this.byId("viewSettingsDialog").open(sDialogTab);                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onConfirmViewSettingsDialog: function (oEvent) {                                                                                                                                                                                                   
                var mParams = oEvent.getParameters(),                                                                                                                                                                                                          
                    sPath,                                                                                                                                                                                                                                     
                    bDescending,                                                                                                                                                                                                                               
                    aSorters = [];                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                sPath = mParams.sortItem.getKey();                                                                                                                                                                                                             
                bDescending = mParams.sortDescending;                                                                                                                                                                                                          
                aSorters.push(new Sorter(sPath, bDescending));                                                                                                                                                                                                 
                this._oTable.getBinding("items").sort(aSorters);                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            //------------------------------&nbsp;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            //------------------------------ Criando novo material                                                                                                                                                                                             
            onBtnCreatePress: function () {                                                                                                                                                                                                                    
                var oEditModel = this.getView().getModel("editMaterialModel");                                                                                                                                                                                 
                oEditModel.setProperty("/isNotNew", false);                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                var oModel = this.getView().getModel();                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                oModel.setDeferredGroups(["creategroupId"]);                                                                                                                                                                                                   
                oModel.setChangeGroups({                                                                                                                                                                                                                       
                    zlmot021Set: {                                                                                                                                                                                                                             
                        groupId: "creategroupId",                                                                                                                                                                                                              
                        changeSetId: "ID",                                                                                                                                                                                                                     
                    },                                                                                                                                                                                                                                         
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var oContext = oModel.createEntry("/zlmot021Set", {                                                                                                                                                                                            
                    groupId: "creategroupId",                                                                                                                                                                                                                  
                    properties: {},                                                                                                                                                                                                                            
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                this.getView().bindElement(oContext.getPath())                                                                                                                                                                                                 
                this._onViewNewOpen();                                                                                                                                                                                                                         
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            _onViewNewOpen: function () {                                                                                                                                                                                                                      
                if (!this.oDialogNewMaterial) {                                                                                                                                                                                                                
                    this.oDialogNewMaterial = Fragment.load({                                                                                                                                                                                                  
                        id: this.getView().getId(),                                                                                                                                                                                                            
                        name: "com.lit.zui5.material.deposito.view.ViewNew",                                                                                                                                                                                   
                        controller: this,                                                                                                                                                                                                                      
                    }).then(                                                                                                                                                                                                                                   
                        function (oDialog) {                                                                                                                                                                                                                   
                            // connect dialog to the root view of this component (models, lifecycle)                                                                                                                                                           
                            this.getView().addDependent(oDialog);                                                                                                                                                                                              
                            oDialog.addStyleClass(                                                                                                                                                                                                             
                                this.getOwnerComponent().getContentDensityClass()                                                                                                                                                                              
                            );                                                                                                                                                                                                                                 
                            this.oDialogNewMaterial = oDialog;                                                                                                                                                                                                 
                            this.oDialogNewMaterial.open();                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            this.buttonPressed = this.oDialogNewMaterial;                                                                                                                                                                                      
                        }.bind(this)                                                                                                                                                                                                                           
                    );                                                                                                                                                                                                                                         
                } else {                                                                                                                                                                                                                                       
                    this.oDialogNewMaterial.open();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    this.buttonPressed = this.oDialogNewMaterial;                                                                                                                                                                                              
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
            //------------------------------&nbsp;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            //------------------------------ Editando Material                                                                                                                                                                                                 
            onBtnEditPress: function (oEvent) {                                                                                                                                                                                                                
                var oEditModel = this.getView().getModel("editMaterialModel");                                                                                                                                                                                 
                oEditModel.setProperty("/isNotNew", true);                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                var oContext = oEvent.getSource().getBindingContext();                                                                                                                                                                                         
                var oModel = new JSONModel(oContext.getObject());                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                // var oModel = this.getView().getModel(); // Use o modelo existente                                                                                                                                                                           
                // var oData = oContext.getObject();                                                                                                                                                                                                           
                // oModel.setProperty(oContext.getPath(), oData);                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                this._onViewEditOpen(oModel);                                                                                                                                                                                                                  
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            _onViewEditOpen: function (oModel) {                                                                                                                                                                                                               
                if (!this.oDialogEditMaterial) {                                                                                                                                                                                                               
                    // this.oDialogEditMaterial = undefined;                                                                                                                                                                                                   
                    this.oDialogEditMaterial = Fragment.load({                                                                                                                                                                                                 
                        id: this.getView().getId(),                                                                                                                                                                                                            
                        name: "com.lit.zui5.material.deposito.view.ViewEdit",                                                                                                                                                                                  
                        controller: this,                                                                                                                                                                                                                      
                    }).then(                                                                                                                                                                                                                                   
                        function (oDialog) {                                                                                                                                                                                                                   
                            this.idDialog = this.byId("dialogEditMaterial");                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            this.getView().addDependent(oDialog);                                                                                                                                                                                              
                            oDialog.addStyleClass(                                                                                                                                                                                                             
                                this.getOwnerComponent().getContentDensityClass()                                                                                                                                                                              
                            );                                                                                                                                                                                                                                 
                            oDialog.setModel(oModel, "oModelItens");                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                            this.oDialogEditMaterial = oDialog;                                                                                                                                                                                                
                            this.oDialogEditMaterial.open();                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            this.buttonPressed = this.oDialogEditMaterial;                                                                                                                                                                                     
                        }.bind(this)                                                                                                                                                                                                                           
                    );                                                                                                                                                                                                                                         
                } else {                                                                                                                                                                                                                                       
                    var oDialogNew = this.idDialog;                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    this.getView().addDependent(oDialogNew);                                                                                                                                                                                                   
                    oDialogNew.addStyleClass(                                                                                                                                                                                                                  
                        this.getOwnerComponent().getContentDensityClass()                                                                                                                                                                                      
                    );                                                                                                                                                                                                                                         
                    oDialogNew.setModel(oModel, "oModelItens");                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    this.oDialogEditMaterial = oDialogNew;                                                                                                                                                                                                     
                    this.oDialogEditMaterial.open();                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    this.buttonPressed = this.oDialogEditMaterial;                                                                                                                                                                                             
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
            //------------------------------&nbsp;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            //------------------------------ Salvando criações e modificações de material                                                                                                                                                                      
            onSaveMaterialButtonPress: function () {                                                                                                                                                                                                           
                var oDataModel = this.getView().getModel();                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                if (this.buttonPressed == this.oDialogEditMaterial) {                                                                                                                                                                                          
                    var oEditModel = this.oDialogEditMaterial.getModel("oModelItens").getData();                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    var oModel = new JSONModel({                                                                                                                                                                                                               
                        Lgnum: oEditModel.Lgnum,                                                                                                                                                                                                               
                        Werks: oEditModel.Werks,                                                                                                                                                                                                               
                        Matnr: oEditModel.Matnr,                                                                                                                                                                                                               
                        Ativo: oEditModel.Ativo,                                                                                                                                                                                                               
                        Status: oEditModel.Status                                                                                                                                                                                                              
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    var _uri = "/zlmot021Set(Lgnum='" + oModel.getData().Lgnum +                                                                                                                                                                               
                        "',Werks='" + oModel.getData().Werks +                                                                                                                                                                                                 
                        "',Matnr='" + oModel.getData().Matnr + "')";                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    oDataModel.update(_uri, oModel.getData(), {                                                                                                                                                                                                
                        success: jQuery.proxy(function (odata, response) {                                                                                                                                                                                     
                            sap.m.MessageToast.show("Material editado com sucesso!", {                                                                                                                                                                         
                                width: "15em",                                                                                                                                                                                                                 
                            });                                                                                                                                                                                                                                
                            this.oDialogEditMaterial.close();                                                                                                                                                                                                  
                        }, this),                                                                                                                                                                                                                              
                        error: jQuery.proxy(function (oError) {                                                                                                                                                                                                
                            var hdrMessageObject = JSON.parse(oError.responseText);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                            sap.m.MessageBox.show(hdrMessageObject.error.message.value, {                                                                                                                                                                      
                                icon: sap.m.MessageBox.Icon.ERROR,                                                                                                                                                                                             
                                title: "Erro ao editar o Material",                                                                                                                                                                                            
                                actions: [sap.m.MessageBox.Action.OK],                                                                                                                                                                                         
                                onClose: null,                                                                                                                                                                                                                 
                                emphasizedAction: sap.m.MessageBox.Action.OK,                                                                                                                                                                                  
                            });                                                                                                                                                                                                                                
                        }, this),                                                                                                                                                                                                                              
                    });                                                                                                                                                                                                                                        
                } else if (this.buttonPressed == this.oDialogNewMaterial) {                                                                                                                                                                                    
                    oDataModel.submitChanges({                                                                                                                                                                                                                 
                        success: this._handleSuccessSave.bind(this),                                                                                                                                                                                           
                        error: this._handleSaveError.bind(this),                                                                                                                                                                                               
                    });                                                                                                                                                                                                                                        
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                // var _uri = oEditModel.__metadata.uri;                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                // if (oModel.hasPendingChanges()) {                                                                                                                                                                                                           
                //     oModel.submitChanges({                                                                                                                                                                                                                  
                //         success: this._handleSuccessSave.bind(this),                                                                                                                                                                                        
                //         error: this._handleSaveError.bind(this),                                                                                                                                                                                            
                //     });                                                                                                                                                                                                                                     
                // } else {                                                                                                                                                                                                                                    
                //     MessageToast.show("Nenhuma alteração para salvar.");                                                                                                                                                                                    
                // }                                                                                                                                                                                                                                           
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            // Analisando se alterações foram bem sucedidas                                                                                                                                                                                                    
            _handleSuccessSave: function (oRes, _oData) {                                                                                                                                                                                                      
                var oModel = this.getView().getModel();                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                if (oRes.__batchResponses[0].response) {                                                                                                                                                                                                       
                    var status = parseInt(oRes.__batchResponses[0].response.statusCode);                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    if (status >= 400) {                                                                                                                                                                                                                       
                        var oResponseBody = JSON.parse(oRes.__batchResponses[0].response.body);                                                                                                                                                                
                        MessageBox.alert("Erro ao Salvar. ERRO: " + oResponseBody.error.message.value);                                                                                                                                                        
                        oModel.resetChanges();                                                                                                                                                                                                                 
                        oModel.refresh();                                                                                                                                                                                                                      
                    } else {                                                                                                                                                                                                                                   
                        MessageToast.show("Salvo com sucesso!");                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        if (this.buttonPressed == this.oDialogNewMaterial) {                                                                                                                                                                                   
                            this.oDialogNewMaterial.close();                                                                                                                                                                                                   
                        } else if (this.buttonPressed == this.oDialogEditMaterial) {                                                                                                                                                                           
                            this.oDialogEditMaterial.close();                                                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                } else if (oRes.__batchResponses[0].__changeResponses) {                                                                                                                                                                                       
                    var status = parseInt(oRes.__batchResponses[0].__changeResponses[0].statusCode);                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    if (status >= 400) {                                                                                                                                                                                                                       
                        MessageBox.alert("Erro ao Salvar");                                                                                                                                                                                                    
                        oModel.resetChanges();                                                                                                                                                                                                                 
                        oModel.refresh();                                                                                                                                                                                                                      
                    } else {                                                                                                                                                                                                                                   
                        MessageToast.show("Salvo com sucesso!");                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        if (this.buttonPressed == this.oDialogNewMaterial) {                                                                                                                                                                                   
                            this.oDialogNewMaterial.close();                                                                                                                                                                                                   
                        } else if (this.buttonPressed == this.oDialogEditMaterial) {                                                                                                                                                                           
                            this.oDialogEditMaterial.close();                                                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            // Em caso de alteração má sucedida                                                                                                                                                                                                                
            _handleSaveError: function (oError) {                                                                                                                                                                                                              
                var oModel = this.getView().getModel();                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                if (oError) {                                                                                                                                                                                                                                  
                    if (oError.responseText) {                                                                                                                                                                                                                 
                        var oErrorMessage = JSON.parse(oError.responseText);                                                                                                                                                                                   
                        MessageBox.alert(oErrorMessage.error.message.value);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        oModel.resetChanges();                                                                                                                                                                                                                 
                        oModel.refresh();                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
            //------------------------------&nbsp;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            //------------------------------ Cancelando criações e edições de material                                                                                                                                                                         
            onCancelMaterial: function () {                                                                                                                                                                                                                    
                var oModel = this.getView().getModel();                                                                                                                                                                                                        
                oModel.resetChanges();                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                if (this.buttonPressed == this.oDialogNewMaterial) {                                                                                                                                                                                           
                    this.oDialogNewMaterial.close();                                                                                                                                                                                                           
                } else if (this.buttonPressed == this.oDialogEditMaterial) {                                                                                                                                                                                   
                    this.oDialogEditMaterial.close();                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
            //------------------------------&nbsp;                                                                                                                                                                                                             
        });                                                                                                                                                                                                                                                    
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               