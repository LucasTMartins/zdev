sap.ui.define(                                                                                                                                                                                                                                                 
  [                                                                                                                                                                                                                                                            
    "sap/ui/core/mvc/Controller",                                                                                                                                                                                                                              
    "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                             
    "../model/formatter",                                                                                                                                                                                                                                      
    "sap/m/MessageBox",                                                                                                                                                                                                                                        
  ],                                                                                                                                                                                                                                                           
  function (Controller, JSONModel, formatter, MessageBox) {                                                                                                                                                                                                    
    "use strict";                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return Controller.extend(                                                                                                                                                                                                                                  
      "br.com.lit.zui5.ne.logistics.offline.controller.CockpitTransfStock",                                                                                                                                                                                    
      {                                                                                                                                                                                                                                                        
        formatter: formatter,                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        onInit: function () {                                                                                                                                                                                                                                  
          const oCockpit = new JSONModel();                                                                                                                                                                                                                    
          this.getView().setModel(oCockpit, "Cockpit");                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
          var oPage = new JSONModel({                                                                                                                                                                                                                          
            page: 0,                                                                                                                                                                                                                                           
            previousPageAvailable: false,                                                                                                                                                                                                                      
            nextPageAvailable: false,                                                                                                                                                                                                                          
          });                                                                                                                                                                                                                                                  
          this.getView().setModel(oPage, "CockpitPage");                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
          const oViewModel = new JSONModel({                                                                                                                                                                                                                   
            sapOnline: true,                                                                                                                                                                                                                                   
          });                                                                                                                                                                                                                                                  
          this.getView().setModel(oViewModel);                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
          // Atribuindo Rotas à metodos específicos                                                                                                                                                                                                            
          const oRouter = this.getOwnerComponent().getRouter();                                                                                                                                                                                                
          oRouter                                                                                                                                                                                                                                              
            .getRoute("RouteCockpitTransfStock")                                                                                                                                                                                                               
            .attachPatternMatched(this.onBeforeShow, this);                                                                                                                                                                                                    
          oRouter                                                                                                                                                                                                                                              
            .getRoute("RouteMenu")                                                                                                                                                                                                                             
            .attachPatternMatched(this.onAfterHide, this);                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
          let oValueHelpStatus = new JSONModel([                                                                                                                                                                                                               
            {                                                                                                                                                                                                                                                  
              status: "PROCESSED",                                                                                                                                                                                                                             
            },                                                                                                                                                                                                                                                 
            {                                                                                                                                                                                                                                                  
              status: "PENDING",                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            {                                                                                                                                                                                                                                                  
              status: "ERROR",                                                                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
            {                                                                                                                                                                                                                                                  
              status: "CANCELED",                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
          ]);                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
          this.getView().setModel(oValueHelpStatus, "ValueHelpStatus");                                                                                                                                                                                        
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        // Toda vez que a rota é aberta, se os dados são carregados e se inicia um intervalo para verificação se o sistema SAP está online                                                                                                                     
        onBeforeShow: function () {                                                                                                                                                                                                                            
          self = this;                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
          // Voltando para a primeira página ao reabrir a tela                                                                                                                                                                                                 
          let pageModel = this.getView().getModel("CockpitPage");                                                                                                                                                                                              
          pageModel.setProperty("/page", 0);                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
          this.onBtnClearPress();                                                                                                                                                                                                                              
          this.getCockpitData();                                                                                                                                                                                                                               
          this.checkStatusOnline();                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
          this.intervalHandler = setInterval(function () {                                                                                                                                                                                                     
            self.getCockpitData();                                                                                                                                                                                                                             
            self.checkStatusOnline();                                                                                                                                                                                                                          
          }, 60000);                                                                                                                                                                                                                                           
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        // Toda vez que o usuário volta para a rota de menu, o intervalo é parado                                                                                                                                                                              
        onAfterHide: function () {                                                                                                                                                                                                                             
          clearInterval(this.intervalHandler);                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        getCockpitData: function () {                                                                                                                                                                                                                          
          let dataModel = this.getView().getModel("Cockpit");                                                                                                                                                                                                  
          var pageModel = this.getView().getModel("CockpitPage");                                                                                                                                                                                              
          let page = pageModel.getProperty("/page");                                                                                                                                                                                                           
          let searchFieldStatus = this.getView().byId("searchFieldStatus");                                                                                                                                                                                    
          let searchFieldWerks = this.getView().byId("searchFieldWerks");                                                                                                                                                                                      
          let searchFieldLgnum = this.getView().byId("searchFieldLgnum");                                                                                                                                                                                      
          let searchFieldCrdate = this.getView().byId("searchFieldCrdate");                                                                                                                                                                                    
          let searchFieldCrtimeIni = this.getView().byId(                                                                                                                                                                                                      
            "searchFieldCrtimeIni"                                                                                                                                                                                                                             
          );                                                                                                                                                                                                                                                   
          let searchFieldCrtimeFim = this.getView().byId(                                                                                                                                                                                                      
            "searchFieldCrtimeFim"                                                                                                                                                                                                                             
          );                                                                                                                                                                                                                                                   
          let status = searchFieldStatus.getValue()                                                                                                                                                                                                            
            ? searchFieldStatus.getValue().toUpperCase()                                                                                                                                                                                                       
            : "PENDING";                                                                                                                                                                                                                                       
          let url = `http://localhost:8080/v1/intfsap?page=${page}sort=crdate&status=${status}`;                                                                                                                                                               
                                                                                                                                                                                                                                                               
          let validStatus = this.getView()                                                                                                                                                                                                                     
            .getModel("ValueHelpStatus")                                                                                                                                                                                                                       
            .getData()                                                                                                                                                                                                                                         
            .find((cell) => cell.status === status);                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
          // Validando valor do Status                                                                                                                                                                                                                         
          if (!validStatus) {                                                                                                                                                                                                                                  
            MessageBox.error("Status inválido!");                                                                                                                                                                                                              
            return;                                                                                                                                                                                                                                            
          }                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
          // Filtrando Centro                                                                                                                                                                                                                                  
          if (searchFieldWerks.getValue() !== "") {                                                                                                                                                                                                            
            url += "&werks=" + searchFieldWerks.getValue();                                                                                                                                                                                                    
          }                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
          // Filtrando Número de Depósito                                                                                                                                                                                                                      
          if (searchFieldLgnum.getValue() !== "") {                                                                                                                                                                                                            
            url += "&lgnum=" + searchFieldLgnum.getValue();                                                                                                                                                                                                    
          }                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            success: function (data) {                                                                                                                                                                                                                         
              data.forEach((item) => {                                                                                                                                                                                                                         
                if (item.charg == "0") {                                                                                                                                                                                                                       
                  item.charg = "";                                                                                                                                                                                                                             
                }                                                                                                                                                                                                                                              
                item.matnr = item.matnr.replace(/^0+/, "");                                                                                                                                                                                                    
                const [datePart, timePart] = item.crdate.split("T"); // Divide em data e hora                                                                                                                                                                  
                const [year, month, day] = datePart.split("-"); // Divide a data no formato "YYYY-MM-DD"                                                                                                                                                       
                                                                                                                                                                                                                                                               
                item.crdate = `${day}/${month}/${year}`; // Formata para "DD-MM-YYYY"                                                                                                                                                                          
                item.crtime = timePart ? timePart.split(".")[0] : ""; // Mantém a hora no formato original                                                                                                                                                     
                item.crdateaux = new Date(                                                                                                                                                                                                                     
                  `${year}-${month}-${day}T${timePart}`                                                                                                                                                                                                        
                ); // Reconstrói o objeto no tipo Date                                                                                                                                                                                                         
              });                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
              let _data = data;                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
              // Filtrando data através do range de Data de Criação                                                                                                                                                                                            
              if (searchFieldCrdate.getValue() !== "") {                                                                                                                                                                                                       
                let searchCrdateValueStart = searchFieldCrdate.getDateValue();                                                                                                                                                                                 
                let searchCrdateValueEnd =                                                                                                                                                                                                                     
                  searchFieldCrdate.getSecondDateValue();                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                _data = data.filter(                                                                                                                                                                                                                           
                  (item) =>                                                                                                                                                                                                                                    
                    searchCrdateValueStart <= item.crdateaux &&                                                                                                                                                                                                
                    item.crdateaux <= searchCrdateValueEnd                                                                                                                                                                                                     
                );                                                                                                                                                                                                                                             
              }                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
              // Filtrando horário através do range de Horário de Criação                                                                                                                                                                                      
              if (searchFieldCrtimeIni.getValue() !== "") {                                                                                                                                                                                                    
                _data =                                                                                                                                                                                                                                        
                  searchFieldCrtimeFim.getValue() !== ""                                                                                                                                                                                                       
                    ? _data.filter(                                                                                                                                                                                                                            
                      (item) =>                                                                                                                                                                                                                                
                        searchFieldCrtimeIni.getValue() <= item.crtime &&                                                                                                                                                                                      
                        item.crtime <= searchFieldCrtimeFim.getValue()                                                                                                                                                                                         
                    )                                                                                                                                                                                                                                          
                    : _data.filter(                                                                                                                                                                                                                            
                      (item) =>                                                                                                                                                                                                                                
                        item.crtime === searchFieldCrtimeIni.getValue()                                                                                                                                                                                        
                    );                                                                                                                                                                                                                                         
              }                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
              dataModel.setData(_data);                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
            error: function (erro) {                                                                                                                                                                                                                           
              console.log(erro);                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
          });                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
          this.verifyPreviousPage();                                                                                                                                                                                                                           
          this.verifyNextPage();                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        verifyPreviousPage: function () {                                                                                                                                                                                                                      
          let pageModel = this.getView().getModel("CockpitPage");                                                                                                                                                                                              
          let page = pageModel.getProperty("/page");                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
          pageModel.setProperty("/previousPageAvailable", page > 0 ? true : false);                                                                                                                                                                            
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        verifyNextPage: function () {                                                                                                                                                                                                                          
          var pageModel = this.getView().getModel("CockpitPage");                                                                                                                                                                                              
          let page = pageModel.getProperty("/page");                                                                                                                                                                                                           
          let searchFieldStatus = this.getView().byId("searchFieldStatus");                                                                                                                                                                                    
          let searchFieldWerks = this.getView().byId("searchFieldWerks");                                                                                                                                                                                      
          let searchFieldLgnum = this.getView().byId("searchFieldLgnum");                                                                                                                                                                                      
          let searchFieldCrdate = this.getView().byId("searchFieldCrdate");                                                                                                                                                                                    
          let searchFieldCrtimeIni = this.getView().byId("searchFieldCrtimeIni");                                                                                                                                                                              
          let searchFieldCrtimeFim = this.getView().byId("searchFieldCrtimeFim");                                                                                                                                                                              
          let status = searchFieldStatus.getValue()                                                                                                                                                                                                            
            ? searchFieldStatus.getValue().toUpperCase()                                                                                                                                                                                                       
            : "PENDING";                                                                                                                                                                                                                                       
          let url = `http://localhost:8080/v1/intfsap?page=${page}sort=crdate&status=${status}`;                                                                                                                                                               
                                                                                                                                                                                                                                                               
          // Filtrando Centro                                                                                                                                                                                                                                  
          if (searchFieldWerks.getValue() !== "") {                                                                                                                                                                                                            
            url += "&werks=" + searchFieldWerks.getValue();                                                                                                                                                                                                    
          }                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
          // Filtrando Número de Depósito                                                                                                                                                                                                                      
          if (searchFieldLgnum.getValue() !== "") {                                                                                                                                                                                                            
            url += "&lgnum=" + searchFieldLgnum.getValue();                                                                                                                                                                                                    
          }                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            success: function () {                                                                                                                                                                                                                             
              pageModel.setProperty("/nextPageAvailable", data.length > 0 ? true : false);                                                                                                                                                                     
            },                                                                                                                                                                                                                                                 
            error: function () {                                                                                                                                                                                                                               
              pageModel.setproperty("/nextpageavailable", false);                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onPreviousPageBtnPress: function () {                                                                                                                                                                                                                  
          let pageModel = this.getView().getModel("CockpitPage");                                                                                                                                                                                              
          let page = pageModel.getProperty("/page") - 1;                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
          pageModel.setProperty("/page", page);                                                                                                                                                                                                                
          this.getCockpitData();                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onNextPageBtnPress: function () {                                                                                                                                                                                                                      
          let pageModel = this.getView().getModel("CockpitPage");                                                                                                                                                                                              
          let page = pageModel.getProperty("/page") + 1;                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
          pageModel.setProperty("/page", page);                                                                                                                                                                                                                
          this.getCockpitData();                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        // Limpando campos de filtro para busca total dos dados                                                                                                                                                                                                
        onBtnClearPress: function () {                                                                                                                                                                                                                         
          this.setFiltersDefaultValues();                                                                                                                                                                                                                      
          this.getView().byId("searchFieldCrdate").setValue();                                                                                                                                                                                                 
          this.getView().byId("searchFieldCrtimeIni").setValue();                                                                                                                                                                                              
          this.getView().byId("searchFieldCrtimeFim").setValue();                                                                                                                                                                                              
          this.getView().byId("searchFieldStatus").setValue();                                                                                                                                                                                                 
          this.getCockpitData();                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        // Valores padrões dos filtros                                                                                                                                                                                                                         
        setFiltersDefaultValues: function () {                                                                                                                                                                                                                 
          this.getView().byId("searchFieldWerks").setValue("VX01");                                                                                                                                                                                            
          this.getView().byId("searchFieldLgnum").setValue("VX1");                                                                                                                                                                                             
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        //----------DIALOG CENTRO----------                                                                                                                                                                                                                    
        onValueHelpWerks: function () {                                                                                                                                                                                                                        
          let oValueHelpWerks = new JSONModel();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
          this.getView().setModel(oValueHelpWerks, "ValueHelpWerks");                                                                                                                                                                                          
          this.byId("valueHelpDialogWerks").open();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
          let dataModel = this.getView().getModel("ValueHelpWerks");                                                                                                                                                                                           
          let url = "http://localhost:8080/v1/lgnum";                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            success: function (data) {                                                                                                                                                                                                                         
              dataModel.setData(data);                                                                                                                                                                                                                         
            },                                                                                                                                                                                                                                                 
            error: function (erro) {                                                                                                                                                                                                                           
              console.log(erro);                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onSearchDialogWerks: function (oEvent) {                                                                                                                                                                                                               
          let oValue = oEvent.getParameter("query");                                                                                                                                                                                                           
          let oTable = this.byId("tableDialogWerks");                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
          oTable.getBinding("items").filter(null);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
          if (oValue) {                                                                                                                                                                                                                                        
            let oFilter = new sap.ui.model.Filter(                                                                                                                                                                                                             
              "werks",                                                                                                                                                                                                                                         
              sap.ui.model.FilterOperator.Contains,                                                                                                                                                                                                            
              oValue                                                                                                                                                                                                                                           
            );                                                                                                                                                                                                                                                 
            oTable.getBinding("items").filter(oFilter);                                                                                                                                                                                                        
          }                                                                                                                                                                                                                                                    
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onSelectionChangeDialogWerks: function (oEvent) {                                                                                                                                                                                                      
          this.oWerks = oEvent                                                                                                                                                                                                                                 
            .getParameter("listItem")                                                                                                                                                                                                                          
            .getBindingContext("ValueHelpWerks")                                                                                                                                                                                                               
            .getProperty("werks");                                                                                                                                                                                                                             
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onSelectionConfirmDialogWerks: function () {                                                                                                                                                                                                           
          this.byId("searchFieldWerks").setValue(this.oWerks);                                                                                                                                                                                                 
          this.byId("valueHelpDialogWerks").close();                                                                                                                                                                                                           
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        //----------DIALOG NÚMERO DE DEPÓSITO----------                                                                                                                                                                                                        
        onValueHelpLgnum: function () {                                                                                                                                                                                                                        
          let oValueHelpLgnum = new JSONModel();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
          this.getView().setModel(oValueHelpLgnum, "ValueHelpLgnum");                                                                                                                                                                                          
          this.byId("valueHelpDialogLgnum").open();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
          let dataModel = this.getView().getModel("ValueHelpLgnum");                                                                                                                                                                                           
          let url = "http://localhost:8080/v1/lgnum";                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            success: function (data) {                                                                                                                                                                                                                         
              dataModel.setData(data);                                                                                                                                                                                                                         
            },                                                                                                                                                                                                                                                 
            error: function (erro) {                                                                                                                                                                                                                           
              console.log(erro);                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onCloseDialogLgnum: function () {                                                                                                                                                                                                                      
          this.byId("valueHelpDialogLgnum").close();                                                                                                                                                                                                           
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onSearchDialogLgnum: function (oEvent) {                                                                                                                                                                                                               
          let oValue = oEvent.getParameter("query");                                                                                                                                                                                                           
          let oTable = this.byId("tableDialogLgnum");                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
          oTable.getBinding("items").filter(null);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
          if (oValue) {                                                                                                                                                                                                                                        
            let oFilter = new sap.ui.model.Filter(                                                                                                                                                                                                             
              "lgnum",                                                                                                                                                                                                                                         
              sap.ui.model.FilterOperator.Contains,                                                                                                                                                                                                            
              oValue                                                                                                                                                                                                                                           
            );                                                                                                                                                                                                                                                 
            oTable.getBinding("items").filter(oFilter);                                                                                                                                                                                                        
          }                                                                                                                                                                                                                                                    
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onSelectionChangeDialogLgnum: function (oEvent) {                                                                                                                                                                                                      
          this.oLgnum = oEvent                                                                                                                                                                                                                                 
            .getParameter("listItem")                                                                                                                                                                                                                          
            .getBindingContext("ValueHelpLgnum")                                                                                                                                                                                                               
            .getProperty("lgnum");                                                                                                                                                                                                                             
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onSelectionConfirmDialogLgnum: function () {                                                                                                                                                                                                           
          this.byId("searchFieldLgnum").setValue(this.oLgnum);                                                                                                                                                                                                 
          this.byId("valueHelpDialogLgnum").close();                                                                                                                                                                                                           
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        //----------DIALOG STATUS----------                                                                                                                                                                                                                    
        onValueHelpStatus: function () {                                                                                                                                                                                                                       
          this.byId("valueHelpDialogStatus").open();                                                                                                                                                                                                           
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onCloseDialogStatus: function () {                                                                                                                                                                                                                     
          this.byId("valueHelpDialogStatus").close();                                                                                                                                                                                                          
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onSelectionChangeDialogStatus: function (oEvent) {                                                                                                                                                                                                     
          this.oStatus = oEvent                                                                                                                                                                                                                                
            .getParameter("listItem")                                                                                                                                                                                                                          
            .getBindingContext("ValueHelpStatus")                                                                                                                                                                                                              
            .getProperty("status");                                                                                                                                                                                                                            
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onSelectionConfirmDialogStatus: function () {                                                                                                                                                                                                          
          this.byId("searchFieldStatus").setValue(this.oStatus);                                                                                                                                                                                               
          this.byId("valueHelpDialogStatus").close();                                                                                                                                                                                                          
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        //-----VERIFICANDO CONEXÃO-----                                                                                                                                                                                                                        
        checkStatusOnline: function () {                                                                                                                                                                                                                       
          const oViewModel = this.getView().getModel();                                                                                                                                                                                                        
          const url =                                                                                                                                                                                                                                          
            "/proxy/sap/bc/gui/sap/its/fmcall_json/ZWMF_VERIFICA_CONEXAO";                                                                                                                                                                                     
          const username = this.getOwnerComponent().USERNAME;                                                                                                                                                                                                  
          const password = this.getOwnerComponent().PASSWORD;                                                                                                                                                                                                  
          const sendBtn = this.byId("sendCockpitBtn");                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
          const credentials = btoa(`${username}:${password}`);                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            headers: {                                                                                                                                                                                                                                         
              Authorization: `Basic ${credentials}`,                                                                                                                                                                                                           
            },                                                                                                                                                                                                                                                 
            success: function () {                                                                                                                                                                                                                             
              oViewModel.setProperty("/sapOnline", true);                                                                                                                                                                                                      
              sendBtn.setEnabled(true);                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
            error: function (erro) {                                                                                                                                                                                                                           
              console.log(erro);                                                                                                                                                                                                                               
              oViewModel.setProperty("/sapOnline", false);                                                                                                                                                                                                     
              // sendBtn.setEnabled(false);                                                                                                                                                                                                                    
              sendBtn.setEnabled(true); // para testes apenas                                                                                                                                                                                                  
            },                                                                                                                                                                                                                                                 
          }).always(() => {                                                                                                                                                                                                                                    
            this.byId("genericTagCockpitStatusOnline").setVisible(true);                                                                                                                                                                                       
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        //-----ENVIANDO DADOS-----                                                                                                                                                                                                                             
        onBtnSendPress: function () {                                                                                                                                                                                                                          
          const tableItems = this.byId("tableCockpit").getSelectedItems();                                                                                                                                                                                     
          const url =                                                                                                                                                                                                                                          
            "/proxy/sap/bc/gui/sap/its/fmcall_json/ZWMF_TRANSF_POSICAO_API";                                                                                                                                                                                   
          const username = this.getOwnerComponent().USERNAME;                                                                                                                                                                                                  
          const password = this.getOwnerComponent().PASSWORD;                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
          tableItems.forEach((item) => {                                                                                                                                                                                                                       
            const id = item                                                                                                                                                                                                                                    
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "id")                                                                                                                                                                                    
              ?.getProperty("text");                                                                                                                                                                                                                           
            const lgnum = item                                                                                                                                                                                                                                 
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "lgnum")                                                                                                                                                                                 
              ?.getProperty("text");                                                                                                                                                                                                                           
            let matnr = item                                                                                                                                                                                                                                   
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "matnr")                                                                                                                                                                                 
              ?.getProperty("text");                                                                                                                                                                                                                           
            matnr = matnr.padStart(18, "0");                                                                                                                                                                                                                   
            const werks = item                                                                                                                                                                                                                                 
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "werks")                                                                                                                                                                                 
              ?.getProperty("text");                                                                                                                                                                                                                           
            // const lgort = item.getCells()                                                                                                                                                                                                                   
            //     .find(cell => cell.getCustomData()[0]?.getValue() === "lgort")                                                                                                                                                                              
            //     ?.getProperty("text");                                                                                                                                                                                                                      
            let charg = item                                                                                                                                                                                                                                   
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "charg")                                                                                                                                                                                 
              ?.getProperty("text");                                                                                                                                                                                                                           
            if (charg == "") {                                                                                                                                                                                                                                 
              charg = "0";                                                                                                                                                                                                                                     
            }                                                                                                                                                                                                                                                  
            const letyp = item                                                                                                                                                                                                                                 
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "letyp")                                                                                                                                                                                 
              ?.getProperty("text");                                                                                                                                                                                                                           
            const anfme = item                                                                                                                                                                                                                                 
              .getCells()                                                                                                                                                                                                                                      
              .find(                                                                                                                                                                                                                                           
                (cell) => cell.getCustomData()[0]?.getValue() === "vermeMeins"                                                                                                                                                                                 
              )                                                                                                                                                                                                                                                
              ?.getProperty("number");                                                                                                                                                                                                                         
            const altme = item                                                                                                                                                                                                                                 
              .getCells()                                                                                                                                                                                                                                      
              .find(                                                                                                                                                                                                                                           
                (cell) => cell.getCustomData()[0]?.getValue() === "vermeMeins"                                                                                                                                                                                 
              )                                                                                                                                                                                                                                                
              ?.getProperty("unit");                                                                                                                                                                                                                           
            const vltyp = item                                                                                                                                                                                                                                 
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "vltyp")                                                                                                                                                                                 
              ?.getProperty("text");                                                                                                                                                                                                                           
            const vlpla = item                                                                                                                                                                                                                                 
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "vlpla")                                                                                                                                                                                 
              ?.getProperty("text");                                                                                                                                                                                                                           
            const nltyp = item                                                                                                                                                                                                                                 
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "nltyp")                                                                                                                                                                                 
              ?.getProperty("text");                                                                                                                                                                                                                           
            const nlpla = item                                                                                                                                                                                                                                 
              .getCells()                                                                                                                                                                                                                                      
              .find((cell) => cell.getCustomData()[0]?.getValue() === "nlpla")                                                                                                                                                                                 
              ?.getProperty("text");                                                                                                                                                                                                                           
            let lgort;                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
            let status;                                                                                                                                                                                                                                        
            let message;                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            $.ajax({                                                                                                                                                                                                                                           
              method: "GET",                                                                                                                                                                                                                                   
              url: `http://localhost:8080/v1/lqua?werks=${werks}&lgnum=${lgnum}&lgtyp=${vltyp}&lgpla=${vlpla}&matnr=${matnr}&charg=${charg}`,                                                                                                                  
              contentType: "application/json",                                                                                                                                                                                                                 
              success: function (response) {                                                                                                                                                                                                                   
                lgort = response[0].lgort;                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                $.ajax({                                                                                                                                                                                                                                       
                  method: "POST",                                                                                                                                                                                                                              
                  url: url,                                                                                                                                                                                                                                    
                  contentType: "application/json",                                                                                                                                                                                                             
                  headers: {                                                                                                                                                                                                                                   
                    Authorization: "Basic " + btoa(username + ":" + password),                                                                                                                                                                                 
                  },                                                                                                                                                                                                                                           
                  data: JSON.stringify({                                                                                                                                                                                                                       
                    I_LGNUM: lgnum,                                                                                                                                                                                                                            
                    I_MATNR: matnr,                                                                                                                                                                                                                            
                    I_WERKS: werks,                                                                                                                                                                                                                            
                    I_LGORT: lgort,                                                                                                                                                                                                                            
                    I_CHARG: charg,                                                                                                                                                                                                                            
                    I_LETYP: letyp,                                                                                                                                                                                                                            
                    I_ANFME: anfme,                                                                                                                                                                                                                            
                    I_ALTME: altme,                                                                                                                                                                                                                            
                    I_VLTYP: vltyp,                                                                                                                                                                                                                            
                    I_VLPLA: vlpla,                                                                                                                                                                                                                            
                    I_NLTYP: nltyp,                                                                                                                                                                                                                            
                    I_NLPLA: nlpla,                                                                                                                                                                                                                            
                  }),                                                                                                                                                                                                                                          
                  success: function (response) {                                                                                                                                                                                                               
                    const successMessage = "Tranferência realizada com sucesso";                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    message =                                                                                                                                                                                                                                  
                      response.E_STATUS === "SUCCESS"                                                                                                                                                                                                          
                        ? successMessage                                                                                                                                                                                                                       
                        : response.E_MSG;                                                                                                                                                                                                                      
                    message = successMessage;                                                                                                                                                                                                                  
                    status = response.E_STATUS;                                                                                                                                                                                                                
                  },                                                                                                                                                                                                                                           
                  error: function (error) {                                                                                                                                                                                                                    
                    console.log(error);                                                                                                                                                                                                                        
                  },                                                                                                                                                                                                                                           
                }).always(() => {                                                                                                                                                                                                                              
                  let dataPut;                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                  const getIntfsap = () => {                                                                                                                                                                                                                   
                    return $.ajax({                                                                                                                                                                                                                            
                      method: "GET",                                                                                                                                                                                                                           
                      url: "http://localhost:8080/v1/intfsap/" + id,                                                                                                                                                                                           
                      contentType: "application/json",                                                                                                                                                                                                         
                      headers: {                                                                                                                                                                                                                               
                        Authorization:                                                                                                                                                                                                                         
                          "Basic " + btoa(username + ":" + password),                                                                                                                                                                                          
                      },                                                                                                                                                                                                                                       
                    });                                                                                                                                                                                                                                        
                  };                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                  const putIntfsap = () => {                                                                                                                                                                                                                   
                    return $.ajax({                                                                                                                                                                                                                            
                      method: "PUT",                                                                                                                                                                                                                           
                      url: "http://localhost:8080/v1/intfsap/" + id,                                                                                                                                                                                           
                      contentType: "application/json",                                                                                                                                                                                                         
                      data: JSON.stringify(dataPut),                                                                                                                                                                                                           
                    }).always(() => {                                                                                                                                                                                                                          
                      this.getCockpitData();                                                                                                                                                                                                                   
                    });                                                                                                                                                                                                                                        
                  };                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                  // Fazendo Get e Put na tabela alterando apenas o status                                                                                                                                                                                     
                  getIntfsap()                                                                                                                                                                                                                                 
                    .then((data) => {                                                                                                                                                                                                                          
                      data.msg = message;                                                                                                                                                                                                                      
                      data.status = status;                                                                                                                                                                                                                    
                      dataPut = data;                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                      return putIntfsap();                                                                                                                                                                                                                     
                    })                                                                                                                                                                                                                                         
                    .always(() => this.getCockpitData());                                                                                                                                                                                                      
                });                                                                                                                                                                                                                                            
              }.bind(this),                                                                                                                                                                                                                                    
              error: function (erro) { },                                                                                                                                                                                                                      
            });                                                                                                                                                                                                                                                
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
      }                                                                                                                                                                                                                                                        
    );                                                                                                                                                                                                                                                         
  }                                                                                                                                                                                                                                                            
);                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               