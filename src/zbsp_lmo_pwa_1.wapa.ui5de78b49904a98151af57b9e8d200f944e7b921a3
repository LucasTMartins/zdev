sap.ui.define(                                                                                                                                                                                                                                                 
    [                                                                                                                                                                                                                                                          
        "sap/ui/core/mvc/Controller",                                                                                                                                                                                                                          
        "sap/ui/core/routing/History",                                                                                                                                                                                                                         
        "sap/m/MessageToast",                                                                                                                                                                                                                                  
        "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                         
        "sap/ui/model/Filter",                                                                                                                                                                                                                                 
        "sap/ui/model/FilterOperator",                                                                                                                                                                                                                         
        "sap/ui/core/Fragment",                                                                                                                                                                                                                                
        "sap/ui/Device",                                                                                                                                                                                                                                       
        "../model/formatter",                                                                                                                                                                                                                                  
    ],                                                                                                                                                                                                                                                         
    function (Controller, History, MessageToast, JSONModel, Filter, FilterOperator, Fragment, Device, formatter) {                                                                                                                                             
        "use strict";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        return Controller.extend(                                                                                                                                                                                                                              
            "br.com.lit.zui5.ne.logistics.offline.controller.ReportPosition",                                                                                                                                                                                  
            {                                                                                                                                                                                                                                                  
                formatter: formatter,                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                onInit: function () {                                                                                                                                                                                                                          
                    // Atribuindo Rotas à metodos específicos                                                                                                                                                                                                  
                    const oRouter = this.getOwnerComponent().getRouter();                                                                                                                                                                                      
                    oRouter.getRoute("RouteReportPosition").attachPatternMatched(this.onBeforeShow, this);                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    var oPage = new JSONModel({                                                                                                                                                                                                                
                        page: 0,                                                                                                                                                                                                                               
                        previousPageAvailable: false,                                                                                                                                                                                                          
                        nextPageAvailable: false,                                                                                                                                                                                                              
                    });                                                                                                                                                                                                                                        
                    this.getView().setModel(oPage, "PositionPage");                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    var oPosition = new JSONModel();                                                                                                                                                                                                           
                    this.getView().setModel(oPosition, "Position")                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    var oFilterLgtyp = new JSONModel();                                                                                                                                                                                                        
                    this.getView().setModel(oFilterLgtyp, "FilterLgtyp")                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    var oFilterLgpla = new JSONModel();                                                                                                                                                                                                        
                    this.getView().setModel(oFilterLgpla, "FilterLgpla")                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    var oFilterLgnum = new JSONModel();                                                                                                                                                                                                        
                    this.getView().setModel(oFilterLgnum, "FilterNumDep")                                                                                                                                                                                      
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                // Toda vez que a rota é aberta, os dados são recarregados                                                                                                                                                                                     
                onBeforeShow: function () {                                                                                                                                                                                                                    
                    // Voltando para a primeira página ao reabrir a tela                                                                                                                                                                                       
                    let pageModel = this.getView().getModel("PositionPage");                                                                                                                                                                                   
                    pageModel.setProperty("/page", 0);                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    this.onClearFilters();                                                                                                                                                                                                                     
                    this._getData();                                                                                                                                                                                                                           
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                _getData: function () {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    var dataModel = this.getView().getModel("Position");                                                                                                                                                                                       
                    var pageModel = this.getView().getModel("PositionPage");                                                                                                                                                                                   
                    let page = pageModel.getProperty("/page");                                                                                                                                                                                                 
                    var url = `http://localhost:8080/v1/lagp?page=${page}&sort=id&sort=lgnum&sort=lgtyp&sort=lgpla&sort=crdate&sort=active`;                                                                                                                   
                                                                                                                                                                                                                                                               
                    if (this.getView().byId("filterNumDep").getValue() !== "") {                                                                                                                                                                               
                        url += "&lgnum=" + this.getView().byId("filterNumDep").getValue();                                                                                                                                                                     
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (this.getView().byId("filterTpDepPos").getValue() !== "") {                                                                                                                                                                             
                        url += "&lgtyp=" + this.getView().byId("filterTpDepPos").getValue();                                                                                                                                                                   
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (this.getView().byId("filterPositionPos").getValue() !== "") {                                                                                                                                                                          
                        url += "&lgpla=" + this.getView().byId("filterPositionPos").getValue();                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    $.ajax({                                                                                                                                                                                                                                   
                        method: "GET",                                                                                                                                                                                                                         
                        url: url,                                                                                                                                                                                                                              
                        success: function (data) {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                            // Usando forEach para dividir o timestamp e armazenar a data e a hora                                                                                                                                                             
                            data.forEach((item) => {                                                                                                                                                                                                           
                                if (item.crdate) {                                                                                                                                                                                                             
                                    const [date, time] = item.crdate.split('T'); // Divide entre data e hora                                                                                                                                                   
                                    item.crdate = date.replace(/-/g, '-'); // Formata a data no padrão DD/MM/AAAA                                                                                                                                              
                                    item.hrdate = time.split('.')[0]; // Remove milissegundos da hora                                                                                                                                                          
                                }                                                                                                                                                                                                                              
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                            dataModel.setData(data);                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        },                                                                                                                                                                                                                                     
                        error: function (erro) {                                                                                                                                                                                                               
                            console.log(erro);                                                                                                                                                                                                                 
                        },                                                                                                                                                                                                                                     
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    this.verifyPreviousPage();                                                                                                                                                                                                                 
                    this.verifyNextPage();                                                                                                                                                                                                                     
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                verifyPreviousPage: function () {                                                                                                                                                                                                              
                    let pageModel = this.getView().getModel("PositionPage");                                                                                                                                                                                   
                    let page = pageModel.getProperty("/page");                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    pageModel.setProperty("/previousPageAvailable", page > 0 ? true : false);                                                                                                                                                                  
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                verifyNextPage: function () {                                                                                                                                                                                                                  
                    var pageModel = this.getView().getModel("PositionPage");                                                                                                                                                                                   
                    let page = pageModel.getProperty("/page") + 1;                                                                                                                                                                                             
                    var url = `http://localhost:8080/v1/lagp?page=${page}&sort=id&sort=lgnum&sort=lgtyp&sort=lgpla&sort=crdate&sort=active`;                                                                                                                   
                                                                                                                                                                                                                                                               
                    if (this.getView().byId("filterNumDep").getValue() !== "") {                                                                                                                                                                               
                        url += "&lgnum=" + this.getView().byId("filterNumDep").getValue();                                                                                                                                                                     
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (this.getView().byId("filterTpDepPos").getValue() !== "") {                                                                                                                                                                             
                        url += "&lgtyp=" + this.getView().byId("filterTpDepPos").getValue();                                                                                                                                                                   
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (this.getView().byId("filterPositionPos").getValue() !== "") {                                                                                                                                                                          
                        url += "&lgpla=" + this.getView().byId("filterPositionPos").getValue();                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    $.ajax({                                                                                                                                                                                                                                   
                        method: "GET",                                                                                                                                                                                                                         
                        url: url,                                                                                                                                                                                                                              
                        success: function (data) {                                                                                                                                                                                                             
                            pageModel.setProperty("/nextPageAvailable", data.length > 0 ? true : false);                                                                                                                                                       
                        },                                                                                                                                                                                                                                     
                        error: function () {                                                                                                                                                                                                                   
                            pageModel.setproperty("/nextpageavailable", false);                                                                                                                                                                                
                        },                                                                                                                                                                                                                                     
                    });                                                                                                                                                                                                                                        
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onPreviousPageBtnPress: function () {                                                                                                                                                                                                          
                    let pageModel = this.getView().getModel("PositionPage");                                                                                                                                                                                   
                    let page = pageModel.getProperty("/page") - 1;                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    pageModel.setProperty("/page", page);                                                                                                                                                                                                      
                    this._getData();                                                                                                                                                                                                                           
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onNextPageBtnPress: function () {                                                                                                                                                                                                              
                    let pageModel = this.getView().getModel("PositionPage");                                                                                                                                                                                   
                    let page = pageModel.getProperty("/page") + 1;                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    pageModel.setProperty("/page", page);                                                                                                                                                                                                      
                    this._getData();                                                                                                                                                                                                                           
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onSearch: function () {                                                                                                                                                                                                                        
                    this._getData();                                                                                                                                                                                                                           
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onClearFilters: function () {                                                                                                                                                                                                                  
                    this.getView().byId("filterTpDepPos").setValue("");                                                                                                                                                                                        
                    this.getView().byId("filterPositionPos").setValue("");                                                                                                                                                                                     
                    this.getView().byId("filterNumDep").setValue("");                                                                                                                                                                                          
                    this._getData();                                                                                                                                                                                                                           
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                // FILTRANDO NUMERO DE DEPÓSITO                                                                                                                                                                                                                
                onFilterNumDep: function () {                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    this.byId("dialogNumDep").open();                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    let dataModel = this.getView().getModel("FilterNumDep");                                                                                                                                                                                   
                    let url = "http://localhost:8080/v1/lgnum";                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    $.ajax({                                                                                                                                                                                                                                   
                        method: "GET",                                                                                                                                                                                                                         
                        url: url,                                                                                                                                                                                                                              
                        contentType: "application/json",                                                                                                                                                                                                       
                        success: function (data) {                                                                                                                                                                                                             
                            dataModel.setData(data);                                                                                                                                                                                                           
                        },                                                                                                                                                                                                                                     
                        error: function (erro) {                                                                                                                                                                                                               
                            console.log(erro);                                                                                                                                                                                                                 
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onModFilterNumDep: function () {                                                                                                                                                                                                               
                    // Obter referência à tabela                                                                                                                                                                                                               
                    var oTable = this.getView().byId("numdepValueHelpTable");                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    // Obter o item selecionado                                                                                                                                                                                                                
                    var oSelectedItem = oTable.getSelectedItem();                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    if (oSelectedItem) {                                                                                                                                                                                                                       
                        // Obter o contexto do modelo associado ao item selecionado                                                                                                                                                                            
                        var oContext = oSelectedItem.getBindingContext("FilterNumDep");                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        // Capturar os valores desejados (exemplo: vote_average)                                                                                                                                                                               
                        var sNumDep = oContext.getProperty("lgnum");                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    this.getView("ReportPosition").byId("filterNumDep").setValue(sNumDep);                                                                                                                                                                     
                    this.byId("dialogNumDep").close();                                                                                                                                                                                                         
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onSearchDialogNumdep: function (oEvent) {                                                                                                                                                                                                      
                    let oValue = oEvent.getParameter("query");                                                                                                                                                                                                 
                    let oTable = this.byId("numdepValueHelpTable");                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    oTable.getBinding("items").filter(null);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    if (oValue) {                                                                                                                                                                                                                              
                        let oFilter = new sap.ui.model.Filter("lgnum", sap.ui.model.FilterOperator.Contains, oValue);                                                                                                                                          
                        oTable.getBinding("items").filter(oFilter);                                                                                                                                                                                            
                    }                                                                                                                                                                                                                                          
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                // FILTRANDO TIPO DE DEPÓSITO                                                                                                                                                                                                                  
                onFilterTpDepPos: function () {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    this.byId("dialogTpDepPos").open();                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    let dataModel = this.getView().getModel("FilterLgtyp");                                                                                                                                                                                    
                    let url = "http://localhost:8080/v1/lgtyp";                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    $.ajax({                                                                                                                                                                                                                                   
                        method: "GET",                                                                                                                                                                                                                         
                        url: url,                                                                                                                                                                                                                              
                        contentType: "application/json",                                                                                                                                                                                                       
                        success: function (data) {                                                                                                                                                                                                             
                            dataModel.setData(data);                                                                                                                                                                                                           
                        },                                                                                                                                                                                                                                     
                        error: function (erro) {                                                                                                                                                                                                               
                            console.log(erro);                                                                                                                                                                                                                 
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onModFilterTpDep: function () {                                                                                                                                                                                                                
                    // Obter referência à tabela                                                                                                                                                                                                               
                    var oTable = this.getView().byId("tpdepposValueHelpTable");                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    // Obter o item selecionado                                                                                                                                                                                                                
                    var oSelectedItem = oTable.getSelectedItem();                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    if (oSelectedItem) {                                                                                                                                                                                                                       
                        // Obter o contexto do modelo associado ao item selecionado                                                                                                                                                                            
                        var oContext = oSelectedItem.getBindingContext("FilterLgtyp");                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        // Capturar os valores desejados (exemplo: vote_average)                                                                                                                                                                               
                        var sTpDep = oContext.getProperty("lgtyp");                                                                                                                                                                                            
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    this.getView("ReportPosition").byId("filterTpDepPos").setValue(sTpDep);                                                                                                                                                                    
                    this.byId("dialogTpDepPos").close();                                                                                                                                                                                                       
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onSearchDialogTpdeppos: function (oEvent) {                                                                                                                                                                                                    
                    let oValue = oEvent.getParameter("query");                                                                                                                                                                                                 
                    let oTable = this.byId("tpdepposValueHelpTable");                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oTable.getBinding("items").filter(null);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    if (oValue) {                                                                                                                                                                                                                              
                        let oFilter = new sap.ui.model.Filter("lgtyp", sap.ui.model.FilterOperator.Contains, oValue);                                                                                                                                          
                        oTable.getBinding("items").filter(oFilter);                                                                                                                                                                                            
                    }                                                                                                                                                                                                                                          
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                // FILTRANDO POSIÇÃO                                                                                                                                                                                                                           
                onFilterPositionPos: function () {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    this.byId("dialogPositionPos").open();                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    let dataModel = this.getView().getModel("FilterLgpla");                                                                                                                                                                                    
                    let url = "http://localhost:8080/v1/lagp";                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    $.ajax({                                                                                                                                                                                                                                   
                        method: "GET",                                                                                                                                                                                                                         
                        url: url,                                                                                                                                                                                                                              
                        contentType: "application/json",                                                                                                                                                                                                       
                        success: function (data) {                                                                                                                                                                                                             
                            dataModel.setData(data);                                                                                                                                                                                                           
                        },                                                                                                                                                                                                                                     
                        error: function (erro) {                                                                                                                                                                                                               
                            console.log(erro);                                                                                                                                                                                                                 
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onModFilterPosition: function () {                                                                                                                                                                                                             
                    // Obter referência à tabela                                                                                                                                                                                                               
                    var oTable = this.getView().byId("positionposValueHelpTable");                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    // Obter o item selecionado                                                                                                                                                                                                                
                    var oSelectedItem = oTable.getSelectedItem();                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    if (oSelectedItem) {                                                                                                                                                                                                                       
                        // Obter o contexto do modelo associado ao item selecionado                                                                                                                                                                            
                        var oContext = oSelectedItem.getBindingContext("FilterLgpla");                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        // Capturar os valores desejados (exemplo: vote_average)                                                                                                                                                                               
                        var sPosition = oContext.getProperty("lgpla");                                                                                                                                                                                         
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    this.getView("ReportPosition").byId("filterPositionPos").setValue(sPosition);                                                                                                                                                              
                    this.byId("dialogPositionPos").close();                                                                                                                                                                                                    
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                onSearchDialogPositionPos: function (oEvent) {                                                                                                                                                                                                 
                    let oValue = oEvent.getParameter("query");                                                                                                                                                                                                 
                    let oTable = this.byId("positionposValueHelpTable");                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oTable.getBinding("items").filter(null);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    if (oValue) {                                                                                                                                                                                                                              
                        let oFilter = new sap.ui.model.Filter("lgpla", sap.ui.model.FilterOperator.Contains, oValue);                                                                                                                                          
                        oTable.getBinding("items").filter(oFilter);                                                                                                                                                                                            
                    }                                                                                                                                                                                                                                          
                },                                                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
        );                                                                                                                                                                                                                                                     
    }                                                                                                                                                                                                                                                          
);                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               