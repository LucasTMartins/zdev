sap.ui.define(                                                                                                                                                                                                                                                 
  [                                                                                                                                                                                                                                                            
    "sap/ui/core/mvc/Controller",                                                                                                                                                                                                                              
    "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                             
  ],                                                                                                                                                                                                                                                           
  function (Controller, JSONModel) {                                                                                                                                                                                                                           
    "use strict";                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return Controller.extend(                                                                                                                                                                                                                                  
      "br.com.lit.zui5.ne.logistics.offline.controller.Menu",                                                                                                                                                                                                  
      {                                                                                                                                                                                                                                                        
        onInit: function () {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
          /******************************************/                                                                                                                                                                                                         
          /* DEIXAR TILES INVÍSIVEIS PARA COLETOR   */                                                                                                                                                                                                         
          /******************************************/                                                                                                                                                                                                         
          let oVisibilityModel = new sap.ui.model.json.JSONModel({                                                                                                                                                                                             
            isSmallScreen: false, // Visibilidade inicial (ajustada no início)                                                                                                                                                                                 
            isLargeScreen: true, // Visibilidade inicial (ajustada no início)                                                                                                                                                                                  
          });                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
          this.getView().setModel(oVisibilityModel, "tileVisibility");                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
          // Atualiza o modelo com base na largura da tela                                                                                                                                                                                                     
          this.updateTileVisibility();                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
          // Evento para ajustar quando a janela for redimensionada                                                                                                                                                                                            
          window.addEventListener(                                                                                                                                                                                                                             
            "resize",                                                                                                                                                                                                                                          
            this.updateTileVisibility.bind(this)                                                                                                                                                                                                               
          );                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
          let oData = {                                                                                                                                                                                                                                        
            countTpDep: 0,                                                                                                                                                                                                                                     
            countPosition: 0,                                                                                                                                                                                                                                  
            countDeposit: 0,                                                                                                                                                                                                                                   
            countBalanceStock: 0,                                                                                                                                                                                                                              
            countCockpitTransfStock: 0,                                                                                                                                                                                                                        
          };                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
          let oCountModel = new JSONModel(oData);                                                                                                                                                                                                              
          this.getView().setModel(oCountModel, "countModel");                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
          this.getCountTpDep();                                                                                                                                                                                                                                
          this.getCountBalanceStock();                                                                                                                                                                                                                         
          this.getCountCockpitTransfStock();                                                                                                                                                                                                                   
          this.getCountDeposit();                                                                                                                                                                                                                              
          this.getCountPosition();                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
          // Obtém o roteador                                                                                                                                                                                                                                  
          this._oRouter = this.getOwnerComponent().getRouter();                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
          if (window.ph) {                                                                                                                                                                                                                                     
            this.getView().byId("installBtn").setVisible(true);                                                                                                                                                                                                
          }                                                                                                                                                                                                                                                    
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        updateTileVisibility: function () {                                                                                                                                                                                                                    
          const screenWidth = window.innerWidth;                                                                                                                                                                                                               
          const oTileVisibilityModel =                                                                                                                                                                                                                         
            this.getView().getModel("tileVisibility");                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
          if (screenWidth <= 768) {                                                                                                                                                                                                                            
            // Exibe apenas o tile para celulares (largura menor ou igual a 768px)                                                                                                                                                                             
            oTileVisibilityModel.setData({                                                                                                                                                                                                                     
              isSmallScreen: true,                                                                                                                                                                                                                             
              isLargeScreen: false,                                                                                                                                                                                                                            
            });                                                                                                                                                                                                                                                
          } else {                                                                                                                                                                                                                                             
            // Exibe os tiles para dispositivos maiores                                                                                                                                                                                                        
            oTileVisibilityModel.setData({                                                                                                                                                                                                                     
              isSmallScreen: false,                                                                                                                                                                                                                            
              isLargeScreen: true,                                                                                                                                                                                                                             
            });                                                                                                                                                                                                                                                
          }                                                                                                                                                                                                                                                    
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        getCountTpDep: function () {                                                                                                                                                                                                                           
          let url = "http://localhost:8080/v1/lgtyp?size=21";                                                                                                                                                                                                  
          let countModel = this.getView().getModel("countModel");                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            success: function (response) {                                                                                                                                                                                                                     
              countModel.setProperty("/countTpDep", response.length > 20 ? "20+" : response.length);                                                                                                                                                           
            }.bind(this),                                                                                                                                                                                                                                      
            error: function (error) {                                                                                                                                                                                                                          
              console.log(error);                                                                                                                                                                                                                              
            }.bind(this),                                                                                                                                                                                                                                      
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        getCountPosition: function () {                                                                                                                                                                                                                        
          let url = "http://localhost:8080/v1/lagp?size=21";                                                                                                                                                                                                   
          let countModel = this.getView().getModel("countModel");                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            success: function (response) {                                                                                                                                                                                                                     
              countModel.setProperty("/countPosition", response.length > 20 ? "20+" : response.length);                                                                                                                                                        
            }.bind(this),                                                                                                                                                                                                                                      
            error: function (error) {                                                                                                                                                                                                                          
              console.log(error);                                                                                                                                                                                                                              
            }.bind(this),                                                                                                                                                                                                                                      
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        getCountDeposit: function () {                                                                                                                                                                                                                         
          let url = "http://localhost:8080/v1/lgnum?size=21";                                                                                                                                                                                                  
          let countModel = this.getView().getModel("countModel");                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            success: function (response) {                                                                                                                                                                                                                     
              countModel.setProperty("/countDeposit", response.length > 20 ? "20+" : response.length);                                                                                                                                                         
            }.bind(this),                                                                                                                                                                                                                                      
            error: function (error) {                                                                                                                                                                                                                          
              console.log(error);                                                                                                                                                                                                                              
            }.bind(this),                                                                                                                                                                                                                                      
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        getCountBalanceStock: function () {                                                                                                                                                                                                                    
          let url = "http://localhost:8080/v1/lqua?size=21";                                                                                                                                                                                                   
          let countModel = this.getView().getModel("countModel");                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            success: function (response) {                                                                                                                                                                                                                     
              countModel.setProperty("/countBalanceStock", response.length > 20 ? "20+" : response.length);                                                                                                                                                    
            }.bind(this),                                                                                                                                                                                                                                      
            error: function (error) {                                                                                                                                                                                                                          
              console.log(error);                                                                                                                                                                                                                              
            }.bind(this),                                                                                                                                                                                                                                      
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        getCountCockpitTransfStock: function () {                                                                                                                                                                                                              
          let url = "http://localhost:8080/v1/intfsap?size=21";                                                                                                                                                                                                
          let countModel = this.getView().getModel("countModel");                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
          $.ajax({                                                                                                                                                                                                                                             
            method: "GET",                                                                                                                                                                                                                                     
            url: url,                                                                                                                                                                                                                                          
            contentType: "application/json",                                                                                                                                                                                                                   
            success: function (response) {                                                                                                                                                                                                                     
              countModel.setProperty(                                                                                                                                                                                                                          
                "/countCockpitTransfStock",                                                                                                                                                                                                                    
                response.length > 20 ? "20+" : response.length                                                                                                                                                                                                 
              );                                                                                                                                                                                                                                               
            }.bind(this),                                                                                                                                                                                                                                      
            error: function (error) {                                                                                                                                                                                                                          
              console.log(error);                                                                                                                                                                                                                              
            }.bind(this),                                                                                                                                                                                                                                      
          });                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        pressReportPosition: function () {                                                                                                                                                                                                                     
          this._oRouter.navTo("RouteReportPosition");                                                                                                                                                                                                          
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        pressReportTpDep: function () {                                                                                                                                                                                                                        
          this._oRouter.navTo("RouteReportTpDep");                                                                                                                                                                                                             
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        pressReportDeposit: function () {                                                                                                                                                                                                                      
          this._oRouter.navTo("RouteReportDeposit");                                                                                                                                                                                                           
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        pressReportBalanceStock: function () {                                                                                                                                                                                                                 
          this._oRouter.navTo("RouteReportBalanceStock");                                                                                                                                                                                                      
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        pressCockpitTransfStock: function () {                                                                                                                                                                                                                 
          this._oRouter.navTo("RouteCockpitTransfStock");                                                                                                                                                                                                      
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        pressColetorTransfStock: function () {                                                                                                                                                                                                                 
          this._oRouter.navTo("RouteColetorTransfStock");                                                                                                                                                                                                      
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        showInstallBtn: function () {                                                                                                                                                                                                                          
          this.getView().byId("installBtn").setVisible(true);                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        installApp: async function () {                                                                                                                                                                                                                        
          if (deferredPrompt) {                                                                                                                                                                                                                                
            deferredPrompt.prompt();                                                                                                                                                                                                                           
            console.log("🆗 Installation Dialog opened");                                                                                                                                                                                                      
            const { outcome } = await deferredPrompt.userChoice;                                                                                                                                                                                               
            // O deferredPrompt só pode ser usado uma vez.                                                                                                                                                                                                     
            deferredPrompt = null;                                                                                                                                                                                                                             
            // Escolha do usuário                                                                                                                                                                                                                              
            if (outcome === "accepted") {                                                                                                                                                                                                                      
              console.log("😀 User accepted the install prompt.", true);                                                                                                                                                                                       
              // Escondendo botão de instalar                                                                                                                                                                                                                  
              this.getView().byId("installBtn").setVisible(false);                                                                                                                                                                                             
            } else if (outcome === "dismissed") {                                                                                                                                                                                                              
              console.log("😟 User dismissed the install prompt");                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
          }                                                                                                                                                                                                                                                    
        }                                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
    );                                                                                                                                                                                                                                                         
  }                                                                                                                                                                                                                                                            
);                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               